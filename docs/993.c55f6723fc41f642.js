"use strict";(self.webpackChunkInvFurniture=self.webpackChunkInvFurniture||[]).push([[993],{6993:(te,O,a)=>{a.r(O),a.d(O,{OrdersModule:()=>W});var h=a(6895),m=a(9051),f=a(4004),e=a(4650),q=a(33);let T=(()=>{class o{constructor(t){this.db=t,this.dbPath="/orders",this.ordersRef=t.collection(this.dbPath)}getNextBatch(t,r){return this.db.collection(this.dbPath,r?n=>n.orderBy("timestamp","desc").startAfter(r).limit(t):n=>n.orderBy("timestamp","desc").limit(t))}getPrevBatch(t,r,n){return this.db.collection(this.dbPath,i=>i.orderBy("timestamp","desc").startAt(r).endBefore(n).limit(t))}getBatch(t){return this.db.collection(this.dbPath,r=>r.limit(t).orderBy("timestamp","desc"))}getAll(){return this.ordersRef}getById(t){return this.db.collection(this.dbPath,r=>r.where("product_id","==",t))}create(t){return this.ordersRef.add({...t})}update(t,r){return this.ordersRef.doc(t).update(r)}delete(t){return this.ordersRef.doc(t).delete()}filterByName(t){return this.db.collection(this.dbPath,r=>r.where("name",">=",t).where("name","<=",t+"\uf8ff"))}filterByCode(t){return this.db.collection(this.dbPath,r=>r.where("code",">=",t).where("code","<=",t+"\uf8ff"))}}return o.\u0275fac=function(t){return new(t||o)(e.LFG(q.ST))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var M=a(6082),l=a(433);function k(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"input",30),e.NdJ("ngModelChange",function(n){e.CHM(t);const i=e.oxw();return e.KtG(i.query=n)}),e.qZA()}if(2&o){const t=e.oxw();e.Q6J("ngModel",t.query)}}function w(o,s){1&o&&(e.TgZ(0,"select",31)(1,"option",32),e._uU(2,"ESPRANDO MATERIAL"),e.qZA(),e.TgZ(3,"option",33),e._uU(4,"INACTIVA"),e.qZA(),e.TgZ(5,"option",34),e._uU(6,"ACTIVA"),e.qZA(),e.TgZ(7,"option",35),e._uU(8,"TERMINADA"),e.qZA()())}function N(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"li",36),e.NdJ("click",function(){const n=e.CHM(t),i=n.$implicit,d=n.index,u=e.oxw();return e.KtG(u.setActiveProduct(i,d))}),e._uU(1),e.qZA()}if(2&o){const t=s.$implicit,r=s.index,n=e.oxw();e.ekj("active",r==n.currentIndex),e.xp6(1),e.AsE(" ",t.name," - ",t.shipDate," ")}}function U(o,s){1&o&&(e.TgZ(0,"div"),e._UZ(1,"br"),e.TgZ(2,"p"),e._uU(3,"Seleccione una orden..."),e.qZA()())}function J(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"li",74)(1,"div",75)(2,"div",76),e._uU(3),e.qZA(),e.TgZ(4,"div",77)(5,"input",78),e.NdJ("ngModelChange",function(n){const d=e.CHM(t).$implicit;return e.KtG(d.quantity=n)}),e.qZA(),e.TgZ(6,"span",43),e._uU(7,"U"),e.qZA(),e.TgZ(8,"input",79),e.NdJ("ngModelChange",function(n){const d=e.CHM(t).$implicit;return e.KtG(d.stock=n)}),e.qZA(),e.TgZ(9,"span",43),e._uU(10,"U"),e.qZA(),e.TgZ(11,"div",80)(12,"label",4),e._uU(13," Uso PT"),e.qZA(),e.TgZ(14,"input",81),e.NdJ("ngModelChange",function(n){e.CHM(t);const i=e.oxw(2);return e.KtG(i.codeFilter=n)}),e.qZA()()(),e.TgZ(15,"button",82),e.NdJ("click",function(){const i=e.CHM(t).index,d=e.oxw(2);return e.KtG(d.removeProductFromOrder(i))}),e.qZA()()()}if(2&o){const t=s.$implicit,r=e.oxw(2);e.xp6(3),e.hij(" ",t.name," "),e.xp6(2),e.Q6J("ngModel",t.quantity),e.xp6(3),e.Q6J("ngModel",t.stock),e.xp6(6),e.Q6J("ngModel",r.codeFilter)}}const I=function(o){return{id:o}};function D(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",37)(1,"h4"),e._uU(2,"Orden"),e.qZA(),e.TgZ(3,"div",38)(4,"input",39),e.NdJ("ngModelChange",function(n){e.CHM(t);const i=e.oxw();return e.KtG(i.currentOrder.name=n)}),e.qZA(),e.TgZ(5,"label",40),e._uU(6,"Numero de Orden de Pedido"),e.qZA()(),e.TgZ(7,"div",41)(8,"input",42),e.NdJ("ngModelChange",function(n){e.CHM(t);const i=e.oxw();return e.KtG(i.currentOrder.clientName=n)}),e.qZA(),e.TgZ(9,"span",43)(10,"a",44),e.O4$(),e.TgZ(11,"svg",45),e._UZ(12,"path",46)(13,"path",47),e.qZA()()(),e.kcU(),e.TgZ(14,"label",48),e._uU(15,"Nombre del Cliente"),e.qZA()(),e.TgZ(16,"div",49)(17,"div",50)(18,"div",51)(19,"input",52),e.NdJ("ngModelChange",function(n){e.CHM(t);const i=e.oxw();return e.KtG(i.currentOrder.shipDate=n)}),e.qZA(),e.TgZ(20,"label",53),e._uU(21,"Fecha de Embarque"),e.qZA()(),e.TgZ(22,"div",54)(23,"input",55),e.NdJ("ngModelChange",function(n){e.CHM(t);const i=e.oxw();return e.KtG(i.currentOrder.state=n)}),e.qZA(),e.TgZ(24,"label",56),e._uU(25,"Estado"),e.qZA()()(),e.TgZ(26,"div",57)(27,"div",41)(28,"input",58),e.NdJ("ngModelChange",function(n){e.CHM(t);const i=e.oxw();return e.KtG(i.currentOrder.productionDays=n)}),e.qZA(),e.TgZ(29,"span",43),e._uU(30,"dias"),e.qZA(),e.TgZ(31,"label",59),e._uU(32,"Dias de Produccion"),e.qZA()(),e.TgZ(33,"div",41)(34,"input",60),e.NdJ("ngModelChange",function(n){e.CHM(t);const i=e.oxw();return e.KtG(i.currentOrder.orderInput=n)}),e.qZA(),e.TgZ(35,"span",43),e._uU(36,"d\xedas"),e.qZA(),e.TgZ(37,"label",61),e._uU(38,"Pedido de Insumos"),e.qZA()()(),e.TgZ(39,"div",57)(40,"div",62)(41,"input",63),e.NdJ("ngModelChange",function(n){e.CHM(t);const i=e.oxw();return e.KtG(i.currentOrder.rmOrderDeadline=n)}),e.qZA(),e.TgZ(42,"label",64),e._uU(43,"Pedido Materia Prima"),e.qZA()(),e.TgZ(44,"div",65)(45,"input",66),e.NdJ("ngModelChange",function(n){e.CHM(t);const i=e.oxw();return e.KtG(i.currentOrder.startProductionDeadline=n)}),e.qZA(),e.TgZ(46,"label",67),e._uU(47,"Limite inicio de Produccion"),e.qZA()()(),e.TgZ(48,"div",62)(49,"input",68),e.NdJ("ngModelChange",function(n){e.CHM(t);const i=e.oxw();return e.KtG(i.currentOrder.notes=n)}),e.qZA(),e.TgZ(50,"label",69),e._uU(51,"notas"),e.qZA()()(),e.TgZ(52,"p"),e._uU(53,"productos de la Orden: "),e.qZA(),e.TgZ(54,"ul",70),e.YNc(55,J,16,4,"li",71),e.qZA(),e.TgZ(56,"button",72),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.editProducts())}),e._uU(57,"Editar Orden"),e.qZA(),e.TgZ(58,"button",73),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.completeOrder())}),e._uU(59,"Completar Orden"),e.qZA()()}if(2&o){const t=e.oxw();e.xp6(4),e.Q6J("ngModel",t.currentOrder.name),e.xp6(4),e.Q6J("ngModel",t.currentOrder.clientName),e.xp6(2),e.Q6J("state",e.VKq(11,I,t.currentOrder.clientId)),e.xp6(9),e.Q6J("ngModel",t.currentOrder.shipDate),e.xp6(4),e.Q6J("ngModel",t.currentOrder.state),e.xp6(5),e.Q6J("ngModel",t.currentOrder.productionDays),e.xp6(6),e.Q6J("ngModel",t.currentOrder.orderInput),e.xp6(7),e.Q6J("ngModel",t.currentOrder.rmOrderDeadline),e.xp6(4),e.Q6J("ngModel",t.currentOrder.startProductionDeadline),e.xp6(4),e.Q6J("ngModel",t.currentOrder.notes),e.xp6(6),e.Q6J("ngForOf",t.currentOrder.orderProducts)}}let P=(()=>{class o{constructor(t,r){this.OrderService=t,this.productService=r,this.currentIndex=-1,this.title="",this.query="",this.queryChange=void 0,this.codeFilter=!1,this.productsPerCall=2,this.disableNext=!1,this.disablePrev=!1,this.lastInResponses=[]}ngOnInit(){this.nextPage(!0)}refreshList(){this.currentOrder=void 0,this.currentIndex=-1,this.lastInResponses=[],this.Products=[],this.nextPage(!0)}nextPage(t){var r;if(t){if(this.disableNext)return;this.Products?.length&&this.lastInResponses?.push(this.Products[this.Products.length-1]),r=this.lastInResponses?.length?this.lastInResponses[this.lastInResponses?.length-1]:void 0}else{if(this.disablePrev)return;this.lastInResponses?.pop(),r=this.lastInResponses?.pop()}this.OrderService.getNextBatch(this.productsPerCall,r).snapshotChanges().pipe((0,f.U)(i=>i.map(d=>({id:d.payload.doc.id,...d.payload.doc.data()})))).subscribe(i=>{i.length?(this.Products=i,this.disableNext=i.length<this.productsPerCall,this.disablePrev=!r):this.disableNext=!0},i=>{this.disableNext=!1})}removeProductFromOrder(t){}editProducts(){}useFP(t,r){this.codeFilter?this.productService.getById(t).pipe((0,f.U)(n=>({id:n.id,...n.data()}))).subscribe(n=>{this.currentOrder?.orderProducts&&(this.currentOrder.orderProducts[r].stock=n.stock?n.stock:0)}):this.currentOrder?.orderProducts&&(this.currentOrder.orderProducts[r].stock="")}fullfillOrder(){this.currentOrder?.id&&this.OrderService.update(this.currentOrder.id,{fulfilled:!0}).then(()=>this.refreshList()).catch(t=>console.log(t))}filterProducts(){this.queryChange=this.query,this.Products=[],this.lastInResponses=[],this.nextPage(!0)}setActiveProduct(t,r){this.currentOrder=t,this.currentIndex=r}completeOrder(){this.OrderService.delete(this.currentOrder?.id).then(()=>this.refreshList())}readableDate(t){var r=new Date(t);return r.getDate()+"/"+r.getMonth()+"/"+r.getFullYear()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(T),e.Y36(M.M))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-orders-list"]],decls:41,vars:6,consts:[[1,"container","mt-5","vh-100"],["role","search",1,"d-flex"],[1,"text-muted","text-nowrap"],[1,"ms-5","form-check"],["for","flexCheckDefault",1,"form-check-label"],["type","checkbox","id","flexCheckDefault","name","codeFilter",1,"form-check-input",3,"ngModel","ngModelChange"],["id","query","class","form-control mx-2 float-end","type","search","name","query","placeholder","Buscar por Nombre o Codigo","aria-label","Search",3,"ngModel","ngModelChange",4,"ngIf"],["class","form-select mx-2","aria-label","Default select example",4,"ngIf"],["type","submit",1,"btn","btn-outline-success","float-end",3,"click"],[1,"position-fixed","bottom-0","end-0",2,"margin","6rem","z-index","1070"],["routerLink","add",1,"btn","btn-success","btn-lg","rounded-pill"],["fill","#ffffff","version","1.1","id","Capa_1","xmlns","http://www.w3.org/2000/svg",0,"xmlns","xlink","http://www.w3.org/1999/xlink","width","4vh","height","4vh","viewBox","0 0 47 47",0,"xml","space","preserve","stroke","#ffffff"],["id","SVGRepo_bgCarrier","stroke-width","0"],["id","SVGRepo_tracerCarrier","stroke-linecap","round","stroke-linejoin","round"],["id","SVGRepo_iconCarrier"],["d","M41.267,18.557H26.832V4.134C26.832,1.851,24.99,0,22.707,0c-2.283,0-4.124,1.851-4.124,4.135v14.432H4.141 c-2.283,0-4.139,1.851-4.138,4.135c-0.001,1.141,0.46,2.187,1.207,2.934c0.748,0.749,1.78,1.222,2.92,1.222h14.453V41.27 c0,1.142,0.453,2.176,1.201,2.922c0.748,0.748,1.777,1.211,2.919,1.211c2.282,0,4.129-1.851,4.129-4.133V26.857h14.435 c2.283,0,4.134-1.867,4.133-4.15C45.399,20.425,43.548,18.557,41.267,18.557z"],[1,"list","row","shadow-sm"],[1,"col-md-6"],[1,"list-group","mt-3","mb-3"],["class","list-group-item",3,"active","click",4,"ngFor","ngForOf"],[1,"col-lg-6"],[4,"ngIf"],["class","edit-form",4,"ngIf"],["aria-label","Page navigation",1,"mt-3"],[1,"pagination"],[1,"page-item"],["aria-label","Previous",1,"page-link",3,"click"],["aria-hidden","true"],[1,"page-link","text-black"],["aria-label","Next",1,"page-link",3,"click"],["id","query","type","search","name","query","placeholder","Buscar por Nombre o Codigo","aria-label","Search",1,"form-control","mx-2","float-end",3,"ngModel","ngModelChange"],["aria-label","Default select example",1,"form-select","mx-2"],["selected","","value","1"],["value","2"],["value","3"],["value","4"],[1,"list-group-item",3,"click"],[1,"edit-form"],[1,"form-floating","mb-2"],["id","name","required","","placeholder","name","name","name","readonly","","type","text",1,"form-control",3,"ngModel","ngModelChange"],["for","name"],[1,"form-floating","input-group","mb-2"],["id","clientName","required","","placeholder","description","name","clientName","type","text","readonly","",1,"form-control",3,"ngModel","ngModelChange"],[1,"input-group-text"],["routerLink","/clients",3,"state"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-info-circle"],["d","M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"],["d","m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"],["for","clientName"],[1,"submit-form"],[1,"input-group","mb-2"],[1,"form-floating"],["id","shipDate","name","shipDate","readonly","","required","","type","date",1,"form-control",3,"ngModel","ngModelChange"],["for","shipDate"],[1,"form-floating","input-group-append"],["id","state","name","state","readonly","","required","","type","text",1,"form-control",3,"ngModel","ngModelChange"],["for","state"],[1,"input-group"],["id","productionDays","required","","placeholder","description","name","productionDays","type","number","readonly","",1,"form-control",3,"ngModel","ngModelChange"],["for","productionDays"],["id","orderInput","required","","placeholder","Precio","name","orderInput","type","number","readonly","",1,"form-control",3,"ngModel","ngModelChange"],["for","orderInput"],[1,"form-floating","mb-3"],["id","rmOrderDeadline","name","rmOrderDeadline","required","","type","date","readonly","",1,"form-control",3,"ngModel","ngModelChange"],["for","rmOrderDeadline"],[1,"form-floating","input-group","mb-3"],["id","startProductionDeadline","name","startProductionDeadline","readonly","","required","","type","date",1,"form-control",3,"ngModel","ngModelChange"],["for","startProductionDeadline"],["id","notes","required","","placeholder","notes","name","notes","type","text","readonly","",1,"form-control",3,"ngModel","ngModelChange"],["for","notes"],[1,"list-group","mt-1","mb-3"],["class","list-group-item",4,"ngFor","ngForOf"],[1,"btn","btn-outline-success","mx-auto","mb-3",3,"click"],[1,"btn","btn-outline-primary","ms-2","mb-3",3,"click"],[1,"list-group-item"],[1,"d-flex","flex-row","mx-auto"],[1,"my-auto","text-nowrap"],[1,"input-group","h-25","my-auto","ms-2"],["type","number","placeholder","Unidades","name","UP","readonly","","aria-label","quantity",1,"form-control","input-sm",3,"ngModel","ngModelChange"],["type","number","placeholder","Uso de PT","name","stock","readonly","","aria-label","stock",1,"form-control","input-sm",3,"ngModel","ngModelChange"],[1,"form-check","input-group-append","mx-2","my-auto"],["disabled","","type","checkbox","id","flexCheckDefault","name","codeFilter",1,"form-check-input",3,"ngModel","ngModelChange"],[1,"btn-close","my-auto","btn-sm","rounded-pill","float-end",3,"click"]],template:function(t,r){1&t&&(e.TgZ(0,"div",0)(1,"form",1)(2,"h4",2),e._uU(3,"Lista de Ordenes"),e.qZA(),e.TgZ(4,"div",3)(5,"label",4),e._uU(6," Filtrar por Estado "),e.qZA(),e.TgZ(7,"input",5),e.NdJ("ngModelChange",function(i){return r.codeFilter=i}),e.qZA()(),e.YNc(8,k,1,1,"input",6),e.YNc(9,w,9,0,"select",7),e.TgZ(10,"button",8),e.NdJ("click",function(){return r.filterProducts()}),e._uU(11,"Buscar"),e.qZA()(),e._UZ(12,"hr"),e.TgZ(13,"div",9)(14,"button",10),e.O4$(),e.TgZ(15,"svg",11),e._UZ(16,"g",12)(17,"g",13),e.TgZ(18,"g",14)(19,"g"),e._UZ(20,"path",15),e.qZA()()()()(),e.kcU(),e.TgZ(21,"div",16)(22,"div",17)(23,"ul",18),e.YNc(24,N,2,4,"li",19),e.qZA()(),e.TgZ(25,"div",20),e.YNc(26,U,4,0,"div",21),e.YNc(27,D,60,13,"div",22),e.qZA()(),e.TgZ(28,"nav",23)(29,"ul",24)(30,"li",25)(31,"button",26),e.NdJ("click",function(){return r.nextPage(!1)}),e.TgZ(32,"span",27),e._uU(33,"\xab"),e.qZA()()(),e.TgZ(34,"li",25)(35,"span",28),e._uU(36," Anterior/Siguiente Registro"),e.qZA()(),e.TgZ(37,"li",25)(38,"button",29),e.NdJ("click",function(){return r.nextPage(!0)}),e.TgZ(39,"span",27),e._uU(40,"\xbb"),e.qZA()()()()()()),2&t&&(e.xp6(7),e.Q6J("ngModel",r.codeFilter),e.xp6(1),e.Q6J("ngIf",!r.codeFilter),e.xp6(1),e.Q6J("ngIf",r.codeFilter),e.xp6(15),e.Q6J("ngForOf",r.Products),e.xp6(2),e.Q6J("ngIf",!r.currentOrder),e.xp6(1),e.Q6J("ngIf",r.currentOrder))},dependencies:[h.sg,h.O5,m.rH,m.yS,l._Y,l.YN,l.Kr,l.Fj,l.wV,l.Wl,l.JJ,l.JL,l.Q7,l.On,l.F]}),o})();var F=a(5861),y=a(8179),g=a(4985),A=a(6535),S=a(5561),L=a(490),B=a(3985),R=a(2425),Q=a(798),G=a(4245);function K(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"button",24),e.NdJ("click",function(){e.CHM(t);const n=e.oxw().$implicit,i=e.oxw();return e.KtG(i.addProductToOrder(n))}),e.TgZ(1,"span"),e.O4$(),e.TgZ(2,"svg",25),e._UZ(3,"g",26)(4,"g",27),e.TgZ(5,"g",28)(6,"g")(7,"g"),e._UZ(8,"path",29),e.qZA()()()()()()}}function Y(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"li",22),e.NdJ("click",function(){const n=e.CHM(t),i=n.$implicit,d=n.index,u=e.oxw();return e.KtG(u.setActiveProduct(i,d))}),e.TgZ(1,"span"),e._uU(2),e.qZA(),e.YNc(3,K,9,0,"button",23),e.qZA()}if(2&o){const t=s.$implicit,r=s.index,n=e.oxw();e.ekj("active",r==n.currentIndex),e.xp6(2),e.hij(" ",t.name," "),e.xp6(1),e.Q6J("ngIf",!n.displayClients)}}function H(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"li",33)(1,"div",34)(2,"span",35),e._uU(3),e.qZA(),e.TgZ(4,"div",36)(5,"input",37),e.NdJ("ngModelChange",function(n){const d=e.CHM(t).$implicit;return e.KtG(d.quantity=n)}),e.qZA(),e.TgZ(6,"span",38),e._uU(7,"U"),e.qZA(),e.TgZ(8,"input",39),e.NdJ("ngModelChange",function(n){const d=e.CHM(t).$implicit;return e.KtG(d.stock=n)}),e.qZA(),e.TgZ(9,"span",38),e._uU(10,"U"),e.qZA(),e.TgZ(11,"div",40)(12,"label",4),e._uU(13," Usar PT"),e.qZA(),e._UZ(14,"input",41),e.qZA()(),e.TgZ(15,"button",42),e.NdJ("click",function(){const i=e.CHM(t).index,d=e.oxw(2);return e.KtG(d.removeProductFromOrder(i))}),e.qZA()()()}if(2&o){const t=s.$implicit;e.xp6(3),e.hij(" ",t.name," "),e.xp6(2),e.Q6J("ngModel",t.quantity),e.xp6(3),e.Q6J("ngModel",t.stock),e.xp6(6),e.Q6J("ngModel",t.useFP)}}function E(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",30)(1,"h4"),e._uU(2,"Nueva Orden"),e.qZA(),e.TgZ(3,"app-form",31),e.NdJ("formModel",function(n){e.CHM(t);const i=e.oxw();return e.KtG(i.submit(n))}),e.qZA(),e.TgZ(4,"p"),e._uU(5,"productos de la Orden: "),e.qZA(),e.TgZ(6,"ul",11),e.YNc(7,H,16,4,"li",32),e.qZA()()}if(2&o){const t=e.oxw();e.xp6(3),e.Q6J("formObj",t.formObj),e.xp6(4),e.Q6J("ngForOf",t.orderProducts)}}function j(o,s){1&o&&(e.TgZ(0,"div"),e._UZ(1,"br"),e.TgZ(2,"p"),e._uU(3,"Seleccione un producto..."),e.qZA()())}const V=[{path:"",component:P},{path:"add",component:(()=>{class o{constructor(t,r,n,i,d,u,_,X,ee){this.Productservice=t,this.shopService=r,this.invrmService=n,this.materialService=i,this.orderService=d,this.fos=u,this.clientService=_,this.router=X,this.auditService=ee,this.rL=new e.vpe,this.submitted=!1,this.currentIndex=-1,this.currentProduct={},this.id="",this.query="",this.codeFilter=!1,this.disableNext=!1,this.disablePrev=!0,this.productsPerCall=2,this.displayClients=!1,this.queryChange=void 0,this.lastInResponses=[],this.clientName="",this.updateProducts=!1,this.orderProducts=[],this.getClientName=()=>this.clientName,this.getProductionDays=()=>Math.ceil(this.orderProducts.map(c=>c.leadTime*c.quantity).reduce((c,p)=>c+p,0)),this.getOrderInput=()=>{var c=Math.max(...this.orderProducts.map(p=>p.materialWaitMaxTime));return c!=-1/0?c:0},this.getRmOrderDeadline=(c,p,v)=>{if(!(c&&p&&v))return;const C=new Date(c);return C.setDate(new Date(c).getDate()-v-p),this.formatDateString(C.toLocaleDateString())},this.getStartProductionDeadline=(c,p,v)=>{if(!(c&&p&&v))return;const C=new Date(c);return C.setDate(new Date(c).getDate()-p),this.formatDateString(C.toLocaleDateString())},this.order=history.state;var x=new g.O("Fecha de Embarque","shipDate","date"),Z=new g.O("Dias de Produccion","productionDays","number",void 0,this.getProductionDays),b=new g.O("Pedido de Insumos","orderInput","number",void 0,this.getOrderInput);this.formObj=[[new g.O("Numero de Orden de Pedido","name","text")],[new g.O("Nombre del Client","clientName","text",void 0,this.getClientName)],[x],[Z,b],[new g.O("Pedido Materia Prima","rmOrderDeadline","date",void 0,this.getRmOrderDeadline,[x,Z,b]),new g.O("Limite inicio de Produccion","startProductionDeadline","date",void 0,this.getStartProductionDeadline,[x,Z,b])]]}ngOnInit(){this.getOrderProducts(),this.nextPage(!0)}getOrderProducts(){!this.order.id||this.orderService.getById(this.order?.id).snapshotChanges().pipe((0,f.U)(t=>t.map(r=>({id:r.payload.doc.id,intel:r.payload.doc.data()})))).subscribe(t=>{if(!t.length)return;const r=t;this.orderProducts=r[0].intel.Products,this.id=r[0].id,this.updateProducts=!!this.orderProducts})}nextPage(t){var r,n;if(t){if(this.disableNext)return;this.Products?.length&&this.lastInResponses?.push(this.Products[this.Products.length-1]),r=this.lastInResponses?.length?this.lastInResponses[this.lastInResponses?.length-1]:void 0}else{if(this.disablePrev)return;this.lastInResponses?.pop(),r=this.lastInResponses?.pop()}console.log("Info:",r,this.lastInResponses,this.queryChange),this.queryChange?this.codeFilter?n=this.getService().filterByCodeBatch(this.queryChange,this.productsPerCall,r):(console.log(this.queryChange),n=this.getService().filterByNameBatch(this.queryChange,this.productsPerCall,r)):n=this.getService().getNextBatch(this.productsPerCall,r),n.snapshotChanges().pipe((0,f.U)(i=>i.map(d=>({id:d.payload.doc.id,...d.payload.doc.data()})))).subscribe(i=>{i.length?(console.log(i),this.Products=i,this.disableNext=i.length<this.productsPerCall,this.disablePrev=!r):this.disableNext=!0},i=>{this.disableNext=!1})}filterProducts(){this.queryChange=this.query,this.disableNext=!1,this.Products=[],this.lastInResponses=[],this.nextPage(!0)}setActiveProduct(t,r){this.currentProduct=t,this.currentIndex=r,this.displayClients&&(this.clientName=t.name,this.order.clientId=t.id)}addProductToOrder(t){this.orderProducts.find(n=>n.id==t.id)||this.orderProducts.push({name:t.name,id:t.id,leadTime:t.leadTime,materialWaitMaxTime:t.materialWaitMaxTime,materials:t.materials})}validateForm(){return new Date(this.order.rmOrderDeadline)>new Date}removeProductFromOrder(t){this.orderProducts.splice(t,1)}getService(){return this.displayClients?this.clientService:this.Productservice}showClientList(){this.queryChange=void 0,this.disableNext=!1,this.disablePrev=!0,this.Products=[],this.lastInResponses=[],this.nextPage(!0)}submit(t){this.order=t,this.editProducts()}getTotalMaterials(){return this.orderProducts?(this.orderProducts.forEach(t=>t.materials.forEach(r=>r.quantity*=t.quantity)),this.orderProducts.flatMap(t=>t.materials).reduce((t,r)=>(t[r.id]=t[r.id]?{name:r.name,quantity:t[r.id].quantity+r.quantity,minBatch:r.minBatch}:{name:r.name,quantity:r.quantity,minBatch:r.minBatch},t),{})):[]}updateMaterialStock(){var t=this;Object.entries(this.getTotalMaterials()).forEach(function(){var r=(0,F.Z)(function*(n){var d,i=(yield t.invrmService.getStock(n[0]))||0;if(null!=i.available&&null!=i.commited&&null!=i.wating&&null!=i.watingCommited){if(n[1].quantity<=i.available)d={commited:+i.commited+n[1].quantity,available:+i.available-n[1].quantity};else if(d={watingCommited:+i.watingCommited+n[1].quantity-+i.available,commited:+i.commited+ +i.available,available:0},n[1].quantity-i.available<=i.wating)d={wating:+i.wating+ +i.available-n[1].quantity,...d};else{var u=n[1].quantity-+i.available-+i.wating,_=u<n[1].minBatch?n[1].minBatch-u:0;d={wating:i.wating+_,...d},t.shopService.create(n[0],n[1].name,u+_,_,y.EK.fromDate(new Date(t.order.rmOrderDeadline)),i.id)}t.invrmService.update(i.id,d),t.makeStockReport(n[0],n[1].name,i,d)}});return function(n){return r.apply(this,arguments)}}()),alert("Orden Creada satisfactoriamente"),this.router.navigate(["/orders"])}makeStockReport(t,r,n,i){}editProducts(){if(this.validateForm()){var t=this.orderProducts.map(r=>({id:r.id,name:r.name,quantity:r.quantity}));this.orderService.create({orderProducts:t,state:"Esperando Material",timestamp:y.EK.fromDate(new Date),...this.order}).then(()=>{this.updateMaterialStock()})}else alert("La fecha de Limite del Pedido de material debe ser almenos 2 dias despu\xe9s del dia actual")}useFP(t,r){this.codeFilter?this.Productservice.getById(t).pipe((0,f.U)(n=>({id:n.id,...n.data()}))).subscribe(n=>{this.orderProducts&&(this.orderProducts[r].stock=n.stock?n.stock:0)}):this.orderProducts&&(this.orderProducts[r].stock="")}formatDateString(t){return t.split("/").reverse().join("/").replace(/\//g,"-")}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(M.M),e.Y36(S.l),e.Y36(L.y),e.Y36(B.U),e.Y36(T),e.Y36(A.U),e.Y36(R.y),e.Y36(m.F0),e.Y36(Q.C))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-add-order"]],inputs:{order:"order"},outputs:{rL:"rL"},features:[e._Bn([A.U,{provide:"path",useValue:"/products"}])],decls:34,vars:5,consts:[[1,"container","mt-5","vh-100"],["role","search",1,"d-flex"],[1,"text-muted","text-nowrap","my-auto"],[1,"ms-5","form-check"],["for","flexCheckDefault",1,"form-check-label"],["type","checkbox","id","flexCheckDefault","name","displayClients",1,"form-check-input",3,"ngModel","ngModelChange","change"],["type","search","name","query","placeholder","Buscar por Nombre","aria-label","Search",1,"form-control","ms-2","me-2","float-end",3,"ngModel","ngModelChange"],["type","submit",1,"btn","btn-outline-success","float-end",3,"click"],[1,"list","row","shadow-sm"],[1,"col-md-6"],[1,"text-muted","mt-1"],[1,"list-group","mt-3","mb-3"],["class","list-group-item",3,"active","click",4,"ngFor","ngForOf"],["class","edit-form",4,"ngIf"],[4,"ngIf"],["aria-label","Page navigation",1,"mt-3"],[1,"pagination"],[1,"page-item"],["aria-label","Previous",1,"page-link",3,"click"],["aria-hidden","true"],[1,"page-link","text-black"],["aria-label","Next",1,"page-link",3,"click"],[1,"list-group-item",3,"click"],["class","btn btn-success btn-sm rounded-pill float-end",3,"click",4,"ngIf"],[1,"btn","btn-success","btn-sm","rounded-pill","float-end",3,"click"],["fill","#ffffff","version","1.1","id","Capa_1","xmlns","http://www.w3.org/2000/svg",0,"xmlns","xlink","http://www.w3.org/1999/xlink","width","20px","height","20px","viewBox","0 0 533.973 533.973",0,"xml","space","preserve"],["id","SVGRepo_bgCarrier","stroke-width","0"],["id","SVGRepo_tracerCarrier","stroke-linecap","round","stroke-linejoin","round"],["id","SVGRepo_iconCarrier"],["d","M477.931,52.261c-12.821-12.821-33.605-12.821-46.427,0l-266.96,266.954l-62.075-62.069 c-12.821-12.821-33.604-12.821-46.426,0L9.616,303.572c-12.821,12.821-12.821,33.604,0,46.426l85.289,85.289l46.426,46.426 c12.821,12.821,33.611,12.821,46.426,0l46.426-46.426l290.173-290.174c12.821-12.821,12.821-33.605,0-46.426L477.931,52.261z"],[1,"edit-form"],["btnMes","Crear Orden","modalMessage","\xbfDesea continuar con la creacion de la Orden?",3,"formObj","formModel"],["class","list-group-item",4,"ngFor","ngForOf"],[1,"list-group-item"],[1,"d-flex","flex-row","justify-content-between"],[1,"my-auto"],[1,"input-group"],["type","number","placeholder","Unidades","name","UP","aria-label","quantity",1,"form-control","input-sm",3,"ngModel","ngModelChange"],[1,"input-group-text"],["type","number","readonly","","placeholder","Disponible en PT","name","stock","aria-label","stock",1,"form-control","input-sm",3,"ngModel","ngModelChange"],[1,"form-check","input-group-append","mx-2","my-auto"],["readonlys","","type","checkbox","id","flexCheckDefault","name","codeFilter",1,"form-check-input",3,"ngModel"],[1,"btn-close","my-auto","btn-sm","rounded-pill","float-end",3,"click"]],template:function(t,r){1&t&&(e.TgZ(0,"div",0)(1,"form",1)(2,"h3",2),e._uU(3,"Registrar orden"),e.qZA(),e.TgZ(4,"div",3)(5,"label",4),e._uU(6," Lista de Clientes "),e.qZA(),e.TgZ(7,"input",5),e.NdJ("ngModelChange",function(i){return r.displayClients=i})("change",function(){return r.showClientList()}),e.qZA()(),e.TgZ(8,"input",6),e.NdJ("ngModelChange",function(i){return r.query=i}),e.qZA(),e.TgZ(9,"button",7),e.NdJ("click",function(){return r.filterProducts()}),e._uU(10,"Buscar"),e.qZA()(),e._UZ(11,"hr"),e.TgZ(12,"div",8)(13,"div",9)(14,"h5",10),e._uU(15,"Productos disponibles:"),e.qZA(),e.TgZ(16,"ul",11),e.YNc(17,Y,4,4,"li",12),e.qZA()(),e.TgZ(18,"div",9),e.YNc(19,E,8,2,"div",13),e.YNc(20,j,4,0,"div",14),e.qZA(),e.TgZ(21,"nav",15)(22,"ul",16)(23,"li",17)(24,"button",18),e.NdJ("click",function(){return r.nextPage(!1)}),e.TgZ(25,"span",19),e._uU(26,"\xab"),e.qZA()()(),e.TgZ(27,"li",17)(28,"span",20),e._uU(29," Anterior/Siguiente Registro"),e.qZA()(),e.TgZ(30,"li",17)(31,"button",21),e.NdJ("click",function(){return r.nextPage(!0)}),e.TgZ(32,"span",19),e._uU(33,"\xbb"),e.qZA()()()()()()()),2&t&&(e.xp6(7),e.Q6J("ngModel",r.displayClients),e.xp6(1),e.Q6J("ngModel",r.query),e.xp6(9),e.Q6J("ngForOf",r.Products),e.xp6(2),e.Q6J("ngIf",r.order),e.xp6(1),e.Q6J("ngIf",!r.order))},dependencies:[h.sg,h.O5,G.U,l._Y,l.Fj,l.wV,l.Wl,l.JJ,l.JL,l.On,l.F]}),o})()},{path:"details",component:P}];let $=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[m.Bz.forChild(V),m.Bz]}),o})();var z=a(4466);let W=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[h.ez,$,z.m]}),o})()}}]);