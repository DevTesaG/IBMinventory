"use strict";(self.webpackChunkInvFurniture=self.webpackChunkInvFurniture||[]).push([[932],{2932:(L,m,s)=>{s.r(m),s.d(m,{ShoppingModule:()=>F});var c=s(6895),p=s(9051),v=s(5861),_=s(4004),a=s(4985),h=s(8179),e=s(4650),O=s(5561),C=s(490),l=s(433);let Z=(()=>{class r{transform(t,...n){return t.toDate().toLocaleDateString().split("/").reverse().join("/").replace(/\//g,"-")}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275pipe=e.Yjl({name:"date",type:r,pure:!0}),r})();function M(r,d){if(1&r){const t=e.EpF();e.TgZ(0,"input",32),e.NdJ("ngModelChange",function(o){e.CHM(t);const i=e.oxw();return e.KtG(i.query=o)}),e.qZA()}if(2&r){const t=e.oxw();e.Q6J("ngModel",t.query)}}function b(r,d){1&r&&(e.TgZ(0,"select",33)(1,"option",34),e._uU(2,"TODOS"),e.qZA(),e.TgZ(3,"option",35),e._uU(4,"URGENTE"),e.qZA()())}function x(r,d){if(1&r){const t=e.EpF();e.TgZ(0,"li",36),e.NdJ("click",function(){const o=e.CHM(t),i=o.$implicit,u=o.index,J=e.oxw();return e.KtG(J.setActiveProduct(i,u))}),e._uU(1),e.qZA()}if(2&r){const t=d.$implicit,n=d.index,o=e.oxw();e.ekj("active",n==o.currentIndex),e.xp6(1),e.AsE(" ",t.name," - ",t.orderDeadline.toDate().toLocaleDateString("es-MX",o.dateOptions)," ")}}function S(r,d){1&r&&(e.TgZ(0,"div"),e._UZ(1,"br"),e.TgZ(2,"p"),e._uU(3,"Seleccione una orden..."),e.qZA()())}function T(r,d){if(1&r){const t=e.EpF();e.TgZ(0,"div",37)(1,"h4"),e._uU(2,"Orden de Compra"),e.qZA(),e.TgZ(3,"div",38)(4,"input",39),e.NdJ("ngModelChange",function(o){e.CHM(t);const i=e.oxw();return e.KtG(i.currentOrder.name=o)}),e.qZA(),e.TgZ(5,"label",40),e._uU(6,"Nombre del Material"),e.qZA()(),e.TgZ(7,"div",41)(8,"div",42)(9,"div",43),e._UZ(10,"input",44),e.ALo(11,"date"),e.TgZ(12,"label",45),e._uU(13,"Fecha Limite Entrega del Material"),e.qZA()(),e.TgZ(14,"div",46),e._UZ(15,"input",47),e.ALo(16,"date"),e.TgZ(17,"label",48),e._uU(18,"Fecha de Emision de Orden"),e.qZA()()(),e.TgZ(19,"div",49)(20,"div",38)(21,"input",50),e.NdJ("ngModelChange",function(o){e.CHM(t);const i=e.oxw();return e.KtG(i.currentOrder.requiredMaterial=o)}),e.qZA(),e.TgZ(22,"span",51),e._uU(23,"unidades"),e.qZA(),e.TgZ(24,"label",52),e._uU(25,"Cantidad Solicitada"),e.qZA()(),e.TgZ(26,"div",38)(27,"input",53),e.NdJ("ngModelChange",function(o){e.CHM(t);const i=e.oxw();return e.KtG(i.currentOrder.cost=o)}),e.qZA(),e.TgZ(28,"span",51),e._uU(29,"d\xedas"),e.qZA(),e.TgZ(30,"label",54),e._uU(31,"Costo del pedido"),e.qZA()()()()()}if(2&r){const t=e.oxw();e.xp6(4),e.Q6J("ngModel",t.currentOrder.name),e.xp6(6),e.Q6J("ngModel",e.lcZ(11,5,t.currentOrder.orderDeadline)),e.xp6(5),e.Q6J("ngModel",e.lcZ(16,7,t.currentOrder.emissionDate)),e.xp6(6),e.Q6J("ngModel",t.currentOrder.requiredMaterial),e.xp6(6),e.Q6J("ngModel",t.currentOrder.cost)}}let A=(()=>{class r{constructor(t,n){this.OrderService=t,this.invrmService=n,this.currentIndex=-1,this.title="",this.query="",this.queryChange=void 0,this.codeFilter=!1,this.productsPerCall=2,this.disableNext=!1,this.disablePrev=!1,this.lastInResponses=[],this.dateOptions={weekday:"long",year:"numeric",month:"long",day:"numeric"},this.formObj=[[new a.O("Nombre del Material","name","text"),new a.O("Cantidad Solicitada","requiredMaterial","number")],[new a.O("Fecha Limite del Material","orderDeadline","date"),new a.O("Fecha de Emision de Orden","emissionDate","date")],[new a.O("Costo del Pedido","cost","number")]]}ngOnInit(){this.nextPage(!0)}refreshList(){this.currentOrder=void 0,this.currentIndex=-1,this.lastInResponses=[],this.shopOrders=[],this.nextPage(!0)}nextPage(t){var n;if(t){if(this.disableNext)return;this.shopOrders?.length&&this.lastInResponses?.push(this.shopOrders[this.shopOrders.length-1]),n=this.lastInResponses?.length?this.lastInResponses[this.lastInResponses?.length-1]:void 0}else{if(this.disablePrev)return;this.lastInResponses?.pop(),n=this.lastInResponses?.pop()}this.OrderService.getNextBatch(this.productsPerCall,n).snapshotChanges().pipe((0,_.U)(i=>i.map(u=>({id:u.payload.doc.id,...u.payload.doc.data()})))).subscribe(i=>{i.length?(console.log(i),this.shopOrders=i,this.disableNext=i.length<this.productsPerCall,this.disablePrev=!n):this.disableNext=!0},i=>{this.disableNext=!1})}removeProductFromOrder(t){}submit(t){}completeOrder(){var t=this;this.currentOrder&&this.OrderService.update(this.currentOrder.id,{fulfilled:!0}).then((0,v.Z)(function*(){t.refreshList();var n=yield t.invrmService.getStock(t.currentOrder?.materialId);t.currentOrder?.stockId&&null!=t.currentOrder?.requestedAmount&&null!=t.currentOrder?.requiredMaterial&&null!=n.watingCommited&&null!=n.commited&&null!=n.wating&&null!=n.available&&t.invrmService.update(t.currentOrder.stockId,{available:n.available+t.currentOrder.requestedAmount,waiting:n.wating-t.currentOrder?.requestedAmount,watingCommited:n.watingCommited-t.currentOrder.requiredMaterial+t.currentOrder.requestedAmount,commited:n.commited+t.currentOrder?.requiredMaterial-t.currentOrder.requestedAmount})})).catch(n=>console.log(n))}activateOrder(){this.currentOrder&&(this.currentOrder.emissionDate=h.EK.fromDate(new Date),this.OrderService.update(this.currentOrder.id,{emissionDate:this.currentOrder.emissionDate}))}filterProducts(){this.queryChange=this.query,this.shopOrders=[],this.lastInResponses=[],this.nextPage(!0)}setActiveProduct(t,n){this.currentOrder=t,this.currentIndex=n}}return r.\u0275fac=function(t){return new(t||r)(e.Y36(O.l),e.Y36(C.y))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-shop-list"]],decls:45,vars:6,consts:[[1,"container","mt-5","vh-100"],["role","search",1,"d-flex"],[1,"text-muted","text-nowrap"],[1,"ms-5","form-check"],["for","flexCheckDefault",1,"form-check-label"],["type","checkbox","id","flexCheckDefault","name","codeFilter",1,"form-check-input",3,"ngModel","ngModelChange"],["id","query","class","form-control mx-2 float-end","type","search","name","query","placeholder","Buscar por Nombre o Codigo","aria-label","Search",3,"ngModel","ngModelChange",4,"ngIf"],["class","form-select mx-2","aria-label","Default select example",4,"ngIf"],["type","submit",1,"btn","btn-outline-success","float-end",3,"click"],[1,"position-fixed","bottom-0","end-0",2,"margin","6rem","z-index","1070"],["routerLink","add",1,"btn","btn-success","btn-lg","rounded-pill"],["fill","#ffffff","version","1.1","id","Capa_1","xmlns","http://www.w3.org/2000/svg",0,"xmlns","xlink","http://www.w3.org/1999/xlink","width","4vh","height","4vh","viewBox","0 0 47 47",0,"xml","space","preserve","stroke","#ffffff"],["id","SVGRepo_bgCarrier","stroke-width","0"],["id","SVGRepo_tracerCarrier","stroke-linecap","round","stroke-linejoin","round"],["id","SVGRepo_iconCarrier"],["d","M41.267,18.557H26.832V4.134C26.832,1.851,24.99,0,22.707,0c-2.283,0-4.124,1.851-4.124,4.135v14.432H4.141 c-2.283,0-4.139,1.851-4.138,4.135c-0.001,1.141,0.46,2.187,1.207,2.934c0.748,0.749,1.78,1.222,2.92,1.222h14.453V41.27 c0,1.142,0.453,2.176,1.201,2.922c0.748,0.748,1.777,1.211,2.919,1.211c2.282,0,4.129-1.851,4.129-4.133V26.857h14.435 c2.283,0,4.134-1.867,4.133-4.15C45.399,20.425,43.548,18.557,41.267,18.557z"],[1,"list","row","shadow-sm"],[1,"col-md-6"],[1,"list-group","mt-3","mb-3"],["class","list-group-item",3,"active","click",4,"ngFor","ngForOf"],[1,"col-lg-6"],[4,"ngIf"],["class","edit-form",4,"ngIf"],[1,"btn","btn-outline-success","mx-auto","mb-3",3,"click"],[1,"btn","btn-outline-primary","ms-2","mb-3",3,"click"],["aria-label","Page navigation",1,"mt-3"],[1,"pagination"],[1,"page-item"],["aria-label","Previous",1,"page-link",3,"click"],["aria-hidden","true"],[1,"page-link","text-black"],["aria-label","Next",1,"page-link",3,"click"],["id","query","type","search","name","query","placeholder","Buscar por Nombre o Codigo","aria-label","Search",1,"form-control","mx-2","float-end",3,"ngModel","ngModelChange"],["aria-label","Default select example",1,"form-select","mx-2"],["selected","","value","1"],["value","2"],[1,"list-group-item",3,"click"],[1,"edit-form"],[1,"form-floating","input-group","mb-2"],["id","name","required","","placeholder","name","name","name","type","text","readonly","",1,"form-control",3,"ngModel","ngModelChange"],["for","name"],[1,"submit-form"],[1,"input-group","mb-2"],[1,"form-floating"],["readonly","","id","orderDeadline","name","orderDeadline","readonly","","required","","type","date",1,"form-control",3,"ngModel"],["for","orderDeadline"],[1,"form-floating","input-group-append"],["readonly","","id","emissionDate","name","emissionDate","readonly","","required","","type","date",1,"form-control",3,"ngModel"],["for","emissionDate"],[1,"input-group"],["id","requiredMaterial","required","","placeholder","description","name","requiredMaterial","type","number","readonly","",1,"form-control",3,"ngModel","ngModelChange"],[1,"input-group-text"],["for","requiredMaterial"],["id","cost","required","","placeholder","Precio","name","cost","type","number","readonly","",1,"form-control",3,"ngModel","ngModelChange"],["for","cost"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"form",1)(2,"h4",2),e._uU(3,"Lista de Ordenes"),e.qZA(),e.TgZ(4,"div",3)(5,"label",4),e._uU(6," Filtrar por Estado "),e.qZA(),e.TgZ(7,"input",5),e.NdJ("ngModelChange",function(i){return n.codeFilter=i}),e.qZA()(),e.YNc(8,M,1,1,"input",6),e.YNc(9,b,5,0,"select",7),e.TgZ(10,"button",8),e.NdJ("click",function(){return n.filterProducts()}),e._uU(11,"Buscar"),e.qZA()(),e._UZ(12,"hr"),e.TgZ(13,"div",9)(14,"button",10),e.O4$(),e.TgZ(15,"svg",11),e._UZ(16,"g",12)(17,"g",13),e.TgZ(18,"g",14)(19,"g"),e._UZ(20,"path",15),e.qZA()()()()(),e.kcU(),e.TgZ(21,"div",16)(22,"div",17)(23,"ul",18),e.YNc(24,x,2,4,"li",19),e.qZA()(),e.TgZ(25,"div",20),e.YNc(26,S,4,0,"div",21),e.YNc(27,T,32,9,"div",22),e.TgZ(28,"button",23),e.NdJ("click",function(){return n.activateOrder()}),e._uU(29,"Activar Orden"),e.qZA(),e.TgZ(30,"button",24),e.NdJ("click",function(){return n.completeOrder()}),e._uU(31,"Completar Orden"),e.qZA()()(),e.TgZ(32,"nav",25)(33,"ul",26)(34,"li",27)(35,"button",28),e.NdJ("click",function(){return n.nextPage(!1)}),e.TgZ(36,"span",29),e._uU(37,"\xab"),e.qZA()()(),e.TgZ(38,"li",27)(39,"span",30),e._uU(40," Anterior/Siguiente Registro"),e.qZA()(),e.TgZ(41,"li",27)(42,"button",31),e.NdJ("click",function(){return n.nextPage(!0)}),e.TgZ(43,"span",29),e._uU(44,"\xbb"),e.qZA()()()()()()),2&t&&(e.xp6(7),e.Q6J("ngModel",n.codeFilter),e.xp6(1),e.Q6J("ngIf",!n.codeFilter),e.xp6(1),e.Q6J("ngIf",n.codeFilter),e.xp6(15),e.Q6J("ngForOf",n.shopOrders),e.xp6(2),e.Q6J("ngIf",!n.currentOrder),e.xp6(1),e.Q6J("ngIf",n.currentOrder))},dependencies:[c.sg,c.O5,p.rH,l._Y,l.YN,l.Kr,l.Fj,l.wV,l.Wl,l.JJ,l.JL,l.Q7,l.On,l.F,Z]}),r})();class g{}var f=s(6535),q=s(798),y=s(4245);function w(r,d){if(1&r){const t=e.EpF();e.TgZ(0,"div")(1,"div",4)(2,"div",5)(3,"app-form",6),e.NdJ("formModel",function(o){e.CHM(t);const i=e.oxw();return e.KtG(i.submit(o))}),e.qZA()()()()}if(2&r){const t=e.oxw();e.xp6(3),e.Q6J("formObj",t.formObj)}}function N(r,d){if(1&r){const t=e.EpF();e.TgZ(0,"div",7)(1,"h4"),e._uU(2,"El producto a sido registrado Satisfactoriamente!"),e.qZA(),e.TgZ(3,"button",8),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.newShopRM())}),e._uU(4,"A\xf1adir Otro"),e.qZA()()}}const U=[{path:"",component:A},{path:"add",component:(()=>{class r{constructor(t,n){this.auditService=t,this.fos=n,this.ShopRM=new g,this.submitted=!1,this.round=i=>Math.round(100*i)/100,new a.O("Capacidad por turno","capacityByTurn","number"),this.formObj=[[new a.O("Nombre del Material","name","text"),new a.O("Cantidad Solicitada","requiredMaterial","number")],[new a.O("Fecha Limite del Material","orderDeadline","date"),new a.O("Fecha de Emision de Orden","emissionDate","date")],[new a.O("Costo del Pedido","cost","number")]]}submit(t){this.ShopRM=t,this.saveShopRM()}saveShopRM(){this.ShopRM.timestamp=h.EK.fromDate(new Date),this.fos.create(this.ShopRM).then(()=>{this.submitted=!0})}newShopRM(){this.submitted=!1,this.ShopRM=new g}}return r.\u0275fac=function(t){return new(t||r)(e.Y36(q.C),e.Y36(f.U))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-add-shop-order"]],features:[e._Bn([f.U,{provide:"path",useValue:"/shopOrder"}])],decls:6,vars:2,consts:[[1,"container","vh-100"],[1,"text-muted","mt-5"],[4,"ngIf"],["class","mt-3",4,"ngIf"],[1,"card","mt-4","bg-light","shadow-lg","border-0"],[1,"card-body"],["btnMes","Registar Orden","modalMessage","\xbfDesea continuar con el registro de la orden?",3,"formObj","formModel"],[1,"mt-3"],[1,"btn","btn-outline-success","mt-2",3,"click"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"h5",1),e._uU(2," Registro Orden de Compra de Material"),e.qZA(),e._UZ(3,"hr"),e.YNc(4,w,4,1,"div",2),e.YNc(5,N,5,0,"div",3),e.qZA()),2&t&&(e.xp6(4),e.Q6J("ngIf",!n.submitted),e.xp6(1),e.Q6J("ngIf",n.submitted))},dependencies:[c.O5,y.U]}),r})()}];let k=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[p.Bz.forChild(U),p.Bz]}),r})();var D=s(4466);let F=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[c.ez,k,D.m]}),r})()}}]);