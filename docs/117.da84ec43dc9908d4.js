"use strict";(self.webpackChunkInvFurniture=self.webpackChunkInvFurniture||[]).push([[117],{9117:(z,C,o)=>{o.r(C),o.d(C,{ShoppingModule:()=>k});var g=o(6895),f=o(7486),l=o(4985),c=o(8179),p=o(8996),O=o(5698),u=o(3900),v=o(6451),m=o(8505),q=o(1350),e=o(4650),J=o(5561),_=o(490),D=o(8132),x=o(798),b=o(3651),N=o(2121),S=o(7915),s=o(4006),T=o(5748);function F(r,d){if(1&r){const t=e.EpF();e.TgZ(0,"input",22),e.NdJ("ngModelChange",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.query=i)}),e.qZA()}if(2&r){const t=e.oxw();e.Q6J("ngModel",t.query)}}function E(r,d){if(1&r){const t=e.EpF();e.TgZ(0,"select",23),e.NdJ("ngModelChange",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.orderStateFilter=i)}),e.TgZ(1,"option",24),e._uU(2,"TODAS"),e.qZA(),e.TgZ(3,"option",25),e._uU(4,"URGENTE"),e.qZA()()}if(2&r){const t=e.oxw();e.Q6J("ngModel",t.orderStateFilter),e.xp6(1),e.Q6J("ngValue",void 0)}}function R(r,d){1&r&&(e.TgZ(0,"div"),e._UZ(1,"br"),e.TgZ(2,"p"),e._uU(3,"Seleccione una orden..."),e.qZA()())}const U=function(){return["btn-outline-primary"]};function I(r,d){if(1&r){const t=e.EpF();e.TgZ(0,"div",26)(1,"h4"),e._uU(2,"Orden de Compra"),e.qZA(),e.TgZ(3,"app-form",27),e.NdJ("formModel",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.submit(i))}),e.qZA(),e.TgZ(4,"button",28),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.activateOrder(!0))}),e._uU(5,"Activar Orden"),e.qZA(),e.TgZ(6,"app-warn-modal",29),e.NdJ("continue",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.completeOrder(i))}),e.qZA()()}if(2&r){const t=e.oxw();e.xp6(3),e.Q6J("formObj",t.formObj)("mode",!0)("placeHolder",t.currentOrder),e.xp6(3),e.Q6J("classlist",e.DdM(4,U))}}const L=function(){return["name","orderDeadline"]};let Q=(()=>{class r{constructor(t,n,i,a,M){this.OrderService=t,this.invrmService=n,this.sellOrderService=i,this.audit=a,this.auth=M,this.currentIndex=-1,this.username="anonimo",this.query="",this.queryChange=void 0,this.codeFilter=!1,this.filterKey="name",this.dateOptions={weekday:"long",year:"numeric",month:"long",day:"numeric"},this.auth.user$.subscribe(h=>this.username=h?.displayName),this.formObj=[[new l.O("Nombre del Material","name","text")],[new l.O("Fecha Limite del Material","orderDeadline","date"),new l.O("Fecha de Emision de Orden","emissionDate","date")],[new l.O("Cantidad Comprometida","requiredMaterial","number",[this.postivoEntero]),new l.O("Cantidad Adicional","requestedAmount","number",[this.postivoEntero])],[new l.O("Costo del Pedido","price","number",[this.postivo])],[new l.O("Orden Asociada","orderId","text")]]}ngOnInit(){console.log(this.username)}refreshList(){this.currentOrder=void 0,this.currentIndex=-1}removeProductFromOrder(t){}postivoEntero(t){return t.value>0&&Number.isInteger(+t.value)||!t.value?null:{custom:"debe ser positivo y entero"}}postivo(t){return t.value>0||!t.value?null:{custom:"debe ser positivo"}}submit(t){this.editOrder(t)}getSelectedElement(t){this.currentOrder=t.element,this.currentIndex=t.index,console.log(this.currentOrder)}editOrder(t){if(this.currentOrder&&this.currentOrder.requestedAmount){if((this.currentOrder.requiredMaterial??0)>t.requiredMaterial)return void alert("No puede pedir menos material del requerido para una orden activa");(0,p.D)(this.sellOrderService.update(this.currentOrder.id,{requiredMaterial:t.requiredMaterial})).pipe((0,O.q)(1),(0,u.w)(n=>this.invrmService.getStock(this.currentOrder?.materialId)),(0,u.w)(n=>{var i={waiting:+(n.waiting??0)-(t.requiredMaterial-(this.currentOrder?.requiredMaterial??0))};return(0,v.T)(this.invrmService.update(this.currentOrder?.stockId??"id",i),this.audit.create("Editar",`Stock de Material: ${this.currentOrder?.name}`,this.username,JSON.stringify(i),JSON.stringify(n)))}),(0,m.b)({error:n=>alert(n),complete:()=>alert("Orden editada corredtamente")})).subscribe()}}completeOrder(t){!(t&&this.currentOrder&&this.currentOrder.id)||(0,p.D)(this.OrderService.update(this.currentOrder.id,{fulfilled:!0})).pipe((0,O.q)(1),(0,u.w)(n=>this.invrmService.getStock(this.currentOrder?.materialId)),(0,u.w)(n=>{var i={available:+(n.available??0)+(this.currentOrder?.requestedAmount??0),waiting:+(n.waiting??0)-(this.currentOrder?.requestedAmount??0),waitingCommited:+(n.waitingCommited??0)-+(this.currentOrder?.requiredMaterial??0),commited:+(n.commited??0)+ +(this.currentOrder?.requiredMaterial??0)};return this.currentOrder?.orderId?(0,v.T)(this.invrmService.update(this.currentOrder?.materialId??"id",i),this.sellOrderService.update(this.currentOrder?.orderId??"id",{state:"EN PRODUCCI\xd3N"})):(0,p.D)(this.invrmService.update(this.currentOrder?.materialId??"id",i))}),(0,m.b)({error:n=>alert(n),complete:()=>alert("La orden ha sido completada")})).subscribe()}activateOrder(t){t&&this.currentOrder&&(this.currentOrder.emissionDate=c.EK.fromDate(new Date),(0,q.z)((0,p.D)(this.OrderService.update(this.currentOrder.id,{emissionDate:this.currentOrder.emissionDate}))).pipe((0,m.b)({error:i=>alert(i),complete:()=>alert("La orden a sido activada")})).subscribe())}filter(){this.queryChange=this.codeFilter&&"URGENTE"==this.orderStateFilter?{key:"orderDeadline",value:c.EK.fromDate(new Date)}:{key:"name",value:this.query}}}return r.\u0275fac=function(t){return new(t||r)(e.Y36(J.l),e.Y36(_.y),e.Y36(D.p),e.Y36(x.C),e.Y36(b.e))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-shop-list"]],decls:27,vars:9,consts:[[1,"container","mt-5","vh-100"],["role","search",1,"d-flex"],[1,"text-muted","text-nowrap"],[1,"ms-5","form-check"],["for","flexCheckDefault",1,"form-check-label"],["type","checkbox","id","flexCheckDefault","name","codeFilter",1,"form-check-input",3,"ngModel","ngModelChange"],["id","query","class","form-control mx-2 float-end","type","search","oninput","this.value = this.value.toLowerCase()","name","query","placeholder","Buscar por Nombre o Codigo","aria-label","Search",3,"ngModel","ngModelChange",4,"ngIf"],["class","form-select mx-2","name","state","aria-label","Default select example",3,"ngModel","ngModelChange",4,"ngIf"],["type","submit",1,"btn","btn-outline-success","float-end",3,"click"],[1,"position-fixed","bottom-0","end-0",2,"margin","6rem","z-index","1070"],["routerLink","add",1,"btn","btn-success","btn-lg","rounded-pill"],["fill","#ffffff","version","1.1","id","Capa_1","xmlns","http://www.w3.org/2000/svg",0,"xmlns","xlink","http://www.w3.org/1999/xlink","width","4vh","height","4vh","viewBox","0 0 47 47",0,"xml","space","preserve","stroke","#ffffff"],["id","SVGRepo_bgCarrier","stroke-width","0"],["id","SVGRepo_tracerCarrier","stroke-linecap","round","stroke-linejoin","round"],["id","SVGRepo_iconCarrier"],["d","M41.267,18.557H26.832V4.134C26.832,1.851,24.99,0,22.707,0c-2.283,0-4.124,1.851-4.124,4.135v14.432H4.141 c-2.283,0-4.139,1.851-4.138,4.135c-0.001,1.141,0.46,2.187,1.207,2.934c0.748,0.749,1.78,1.222,2.92,1.222h14.453V41.27 c0,1.142,0.453,2.176,1.201,2.922c0.748,0.748,1.777,1.211,2.919,1.211c2.282,0,4.129-1.851,4.129-4.133V26.857h14.435 c2.283,0,4.134-1.867,4.133-4.15C45.399,20.425,43.548,18.557,41.267,18.557z"],[1,"list","row","shadow-sm"],[1,"col-md-6"],[3,"path","showParams","query","selectedElement"],[1,"col-lg-6"],[4,"ngIf"],["class","edit-form",4,"ngIf"],["id","query","type","search","oninput","this.value = this.value.toLowerCase()","name","query","placeholder","Buscar por Nombre o Codigo","aria-label","Search",1,"form-control","mx-2","float-end",3,"ngModel","ngModelChange"],["name","state","aria-label","Default select example",1,"form-select","mx-2",3,"ngModel","ngModelChange"],[3,"ngValue"],["ngValue","URGENTE"],[1,"edit-form"],["btnMes","Registar Orden","modalMessage","\xbfDesea continuar con el registro de la orden?",3,"formObj","mode","placeHolder","formModel"],[1,"btn","btn-outline-success","mx-auto","mb-3",3,"click"],["btnMessage","Completar Orden","modalMessage","\xbfSeguro que desea completar la orden?",3,"classlist","continue"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"form",1)(2,"h4",2),e._uU(3,"Lista de Ordenes"),e.qZA(),e.TgZ(4,"div",3)(5,"label",4),e._uU(6," Filtrar por Codigo "),e.qZA(),e.TgZ(7,"input",5),e.NdJ("ngModelChange",function(a){return n.codeFilter=a}),e.qZA()(),e.YNc(8,F,1,1,"input",6),e.YNc(9,E,5,2,"select",7),e.TgZ(10,"button",8),e.NdJ("click",function(){return n.filter()}),e._uU(11,"Buscar"),e.qZA()(),e._UZ(12,"hr"),e.TgZ(13,"div",9)(14,"button",10),e.O4$(),e.TgZ(15,"svg",11),e._UZ(16,"g",12)(17,"g",13),e.TgZ(18,"g",14)(19,"g"),e._UZ(20,"path",15),e.qZA()()()()(),e.kcU(),e.TgZ(21,"div",16)(22,"div",17)(23,"app-pagination",18),e.NdJ("selectedElement",function(a){return n.getSelectedElement(a)}),e.qZA()(),e.TgZ(24,"div",19),e.YNc(25,R,4,0,"div",20),e.YNc(26,I,7,5,"div",21),e.qZA()()()),2&t&&(e.xp6(7),e.Q6J("ngModel",n.codeFilter),e.xp6(1),e.Q6J("ngIf",!n.codeFilter),e.xp6(1),e.Q6J("ngIf",n.codeFilter),e.xp6(14),e.Q6J("path","/shopOrder")("showParams",e.DdM(8,L))("query",n.queryChange),e.xp6(2),e.Q6J("ngIf",!n.currentOrder),e.xp6(1),e.Q6J("ngIf",n.currentOrder))},dependencies:[g.O5,f.rH,N.u,S.U,s._Y,s.YN,s.Kr,s.Fj,s.Wl,s.EJ,s.JJ,s.JL,s.On,s.F,T.Q]}),r})();class Z{}var w=o(6535),A=o(1135),y=o(727),P=o(5872);function Y(r,d){if(1&r&&(e.TgZ(0,"option",15),e._uU(1),e.qZA()),2&r){const t=d.$implicit;e.Q6J("ngValue",t),e.xp6(1),e.Oqu(t.name)}}function G(r,d){if(1&r){const t=e.EpF();e.TgZ(0,"div",9)(1,"select",10),e.NdJ("ngModelChange",function(i){e.CHM(t);const a=e.oxw(2);return e.KtG(a.currentProvider=i)})("change",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.getSelectedProvider())}),e.TgZ(2,"option",11),e._uU(3,"Seleccione Provedor"),e.qZA(),e.YNc(4,Y,2,2,"option",12),e.qZA(),e.TgZ(5,"label",13),e._uU(6,"Provedores"),e.qZA(),e.TgZ(7,"app-form",14),e.NdJ("formModel",function(i){e.CHM(t);const a=e.oxw(2);return e.KtG(a.submit(i))}),e.qZA()()}if(2&r){const t=e.oxw(2);e.xp6(1),e.Q6J("ngModel",t.currentProvider),e.xp6(1),e.Q6J("ngValue",void 0),e.xp6(2),e.Q6J("ngForOf",t.providers),e.xp6(3),e.Q6J("formObj",t.formObj)}}function K(r,d){1&r&&(e.TgZ(0,"div"),e._UZ(1,"br"),e.TgZ(2,"p"),e._uU(3,"No se selecciono ningun material..."),e.qZA()())}function H(r,d){if(1&r){const t=e.EpF();e.TgZ(0,"div")(1,"div",4)(2,"div",5)(3,"h5",6),e._uU(4,"Lista de Materiales:"),e.qZA(),e.TgZ(5,"app-pagination",7),e.NdJ("selectedElement",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.getSelectedElement(i))}),e.qZA()(),e.TgZ(6,"div",5)(7,"h4"),e._uU(8,"Orden Material"),e.qZA(),e.YNc(9,G,8,4,"div",8),e.YNc(10,K,4,0,"div",2),e.qZA()()()}if(2&r){const t=e.oxw();e.xp6(5),e.Q6J("path","/materials")("query",t.queryChange),e.xp6(4),e.Q6J("ngIf",t.providers.length),e.xp6(1),e.Q6J("ngIf",!t.currentMaterial)}}function V(r,d){if(1&r){const t=e.EpF();e.TgZ(0,"div",16)(1,"h4"),e._uU(2,"La orden a sido registrada Satisfactoriamente!"),e.qZA(),e.TgZ(3,"button",17),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.newShopRM())}),e._uU(4,"A\xf1adir Otro"),e.qZA()()}}const $=[{path:"",component:Q},{path:"add",component:(()=>{class r{constructor(t,n,i,a,M){this.auditService=t,this.fos=n,this.auth=i,this.provider=a,this.invrmService=M,this.providers=[],this.ShopRM=new Z,this.submitted=!1,this.username="anonimo",this.currentProvider$=new A.X(this.currentProvider?.price),this.currentMaterial$=new A.X(this.currentMaterial?.name),this.createShopOrder$=new y.w0,this.requestedAmount$=new y.w0,this.round=h=>Math.round(100*h)/100,this.auth.user$.subscribe(h=>this.username=h?.displayName??"anonimo"),this.formObj=[[new l.O("Nombre del Material","name","text").setReadOnly(!0)],[new l.O("Fecha Limite del Material","orderDeadline","date",[this.limitAfterToday]),new l.O("Fecha de Emision de Orden","emissionDate","date")],[new l.O("Cantidad Solicitada","requestedAmount","number",[this.mustBePostive]),new l.O("Costo del Pedido","price","number",[this.selectProvider]).setReadOnly(!0)]]}set form(t){t&&(this.currentMaterial$.subscribe(n=>t.f.name.patchValue(n)),this.requestedAmount$=(0,v.T)(this.currentProvider$,t.f.requestedAmount.valueChanges.pipe((0,m.b)(n=>{console.log(n),t.f.price.patchValue(this.currentProvider?.price&&n?this.currentProvider?.price*n:0),t.f.price.markAsTouched()}))).subscribe())}limitAfterToday(t){return new Date(t.value)>new Date||null==t.value?null:{custom:"La fecha de Limite del Pedido de material debe ser almenos 2 dias despu\xe9s del dia actual"}}mustBePostive(t){return t.value>0||null==t.value?null:{custom:"debe ser positivo"}}selectProvider(t){return 0!=t.value||null==t.value?null:{custom:"no puede ser 0, seleccione un proveedor o solicite una cantidad de material"}}getSelectedProvider(){this.currentProvider$.next(this.currentProvider?.price)}getSelectedElement(t){this.currentMaterial=t.element,console.log(this.currentMaterial),this.currentMaterial$.next(this.currentMaterial?.name),this.currentMaterial&&(this.providers=this.currentMaterial.providers??[])}submit(t){this.ShopRM=t,this.saveShopRM()}saveShopRM(){this.ShopRM.timestamp=c.EK.fromDate(new Date),this.ShopRM.orderDeadline=c.EK.fromDate(new Date(this.ShopRM.orderDeadline)),this.ShopRM.emissionDate=c.EK.fromDate(new Date(this.ShopRM.emissionDate)),this.ShopRM.requestedAmount=+(this.ShopRM?.requestedAmount??0),this.ShopRM.requiredMaterial=0,this.ShopRM.materialId=this.currentMaterial?.id,this.createShopOrder$=(0,p.D)(this.fos.create(this.ShopRM)).pipe((0,O.q)(1),(0,u.w)(()=>this.invrmService.getStock(this.currentMaterial?.id)),(0,u.w)(t=>(t.waiting=+t.waiting+ +(this.ShopRM.requestedAmount??0),(0,v.T)(this.invrmService.update(t.id,t)))),(0,m.b)({complete:()=>{this.submitted=!0,alert("Orden Creada")}})).subscribe()}ngOnDestroy(){this.createShopOrder$.unsubscribe()}newShopRM(){this.createShopOrder$.unsubscribe(),this.submitted=!1,this.ShopRM=new Z}}return r.\u0275fac=function(t){return new(t||r)(e.Y36(x.C),e.Y36(w.U),e.Y36(b.e),e.Y36(P.H),e.Y36(_.y))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-add-shop-order"]],viewQuery:function(t,n){if(1&t&&e.Gf(S.U,5),2&t){let i;e.iGM(i=e.CRH())&&(n.form=i.first)}},features:[e._Bn([w.U,{provide:"path",useValue:"/shopOrder"}])],decls:6,vars:2,consts:[[1,"container","vh-100"],[1,"text-muted","mt-5"],[4,"ngIf"],["class","mt-3",4,"ngIf"],[1,"list","row","shadow-sm"],[1,"col-md-6"],[1,"text-muted","mt-1"],[3,"path","query","selectedElement"],["class","form-floating",4,"ngIf"],[1,"form-floating"],["id","floatingSelect","aria-label","providers select",1,"form-select","mt-2","mb-2",3,"ngModel","ngModelChange","change"],["disabled","",3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],["for","floatingSelect"],["btnMes","Registar Orden","modalMessage","\xbfDesea continuar con el registro del proveedor?",3,"formObj","formModel"],[3,"ngValue"],[1,"mt-3"],[1,"btn","btn-outline-success","mt-2",3,"click"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"h5",1),e._uU(2," Registro Orden de Compra de Material"),e.qZA(),e._UZ(3,"hr"),e.YNc(4,H,11,4,"div",2),e.YNc(5,V,5,0,"div",3),e.qZA()),2&t&&(e.xp6(4),e.Q6J("ngIf",!n.submitted),e.xp6(1),e.Q6J("ngIf",n.submitted))},dependencies:[g.sg,g.O5,S.U,s.YN,s.Kr,s.EJ,s.JJ,s.On,T.Q]}),r})()}];let B=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[f.Bz.forChild($),f.Bz]}),r})();var j=o(4466);let k=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[g.ez,B,j.m]}),r})()}}]);