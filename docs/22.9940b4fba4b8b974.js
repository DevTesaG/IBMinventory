"use strict";(self.webpackChunkInvFurniture=self.webpackChunkInvFurniture||[]).push([[22],{4245:(q,w,l)=>{l.d(w,{U:()=>y});var i=l(4650),_=l(4985),x=l(6895),v=l(433);let C=(()=>{class h{constructor(){this.btnMessage="Continuar",this.modalMessage="\xbf Desea continuar con este proceso ? ",this.continue=new i.vpe}ngOnInit(){}modalContinue(d){this.continue.emit(d)}}return h.\u0275fac=function(d){return new(d||h)},h.\u0275cmp=i.Xpm({type:h,selectors:[["app-warn-modal"]],inputs:{btnMessage:"btnMessage",modalMessage:"modalMessage"},outputs:{continue:"continue"},decls:17,vars:2,consts:[[1,"container-fluid","my-3","mx-auto"],["data-bs-toggle","modal","data-bs-target","#staticBackdrop",1,"btn","btn-outline-success","rounded-pill"],["id","staticBackdrop","data-bs-backdrop","static","data-bs-keyboard","false","tabindex","-1","aria-labelledby","staticBackdropLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],["id","staticBackdropLabel",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"modal-footer"],["type","submit","data-bs-dismiss","modal",1,"btn","btn-danger","rounded-pill",3,"click"],["type","button","data-bs-dismiss","modal",1,"btn","btn-success","rounded-pill",3,"click"]],template:function(d,g){1&d&&(i.TgZ(0,"div",0)(1,"button",1),i._uU(2),i.qZA(),i.TgZ(3,"div",2)(4,"div",3)(5,"div",4)(6,"div",5)(7,"h5",6),i._uU(8,"PRECAUCION"),i.qZA(),i.TgZ(9,"button",7),i.NdJ("click",function(){return g.modalContinue(!1)}),i.qZA()(),i.TgZ(10,"div",8),i._uU(11),i.qZA(),i.TgZ(12,"div",9)(13,"button",10),i.NdJ("click",function(){return g.modalContinue(!1)}),i._uU(14,"Abortar"),i.qZA(),i.TgZ(15,"button",11),i.NdJ("click",function(){return g.modalContinue(!0)}),i._uU(16,"Continuar"),i.qZA()()()()()()),2&d&&(i.xp6(2),i.hij(" ",g.btnMessage," "),i.xp6(9),i.hij(" ",g.modalMessage," "))}}),h})();function t(h,M){if(1&h&&(i.TgZ(0,"div"),i._uU(1),i.qZA()),2&h){const d=i.oxw(2).$implicit;i.xp6(1),i.hij("",d.placeholder," es obligatorio")}}function m(h,M){if(1&h&&(i.TgZ(0,"div",12),i.YNc(1,t,2,1,"div",13),i.qZA()),2&h){i.oxw();const d=i.MAs(2);i.xp6(1),i.Q6J("ngIf",d.errors.required)}}function s(h,M){1&h&&i._UZ(0,"div",14)}const c=function(h){return{"is-invalid":h}};function u(h,M){if(1&h){const d=i.EpF();i.TgZ(0,"div",6)(1,"input",7,8),i.NdJ("ngModelChange",function(b){const A=i.CHM(d).$implicit;return i.KtG(A.value=b)}),i.qZA(),i.YNc(3,m,2,1,"div",9),i.TgZ(4,"label",10),i._uU(5),i.qZA(),i.YNc(6,s,1,0,"div",11),i.qZA()}if(2&h){const d=M.$implicit,g=i.MAs(2),b=i.oxw(2),Z=i.MAs(1);i.xp6(1),i.Tol("form-control"+d.classlist),i.Q6J("id",d.label)("name",d.label)("type",d.type)("placeholder",d.placeholder)("ngModel",d.value)("value",d.valueCallback?d.getValue():d.value)("ngClass",i.VKq(14,c,Z.submitted&&g.errors))("readonly",b.mode),i.xp6(2),i.Q6J("ngIf",Z.submitted&&g.errors),i.xp6(1),i.Q6J("for",d.label),i.xp6(1),i.Oqu(d.placeholder),i.xp6(1),i.Q6J("ngIf","radio"==d.type)}}function P(h,M){if(1&h&&(i.TgZ(0,"div",4),i.YNc(1,u,7,16,"div",5),i.qZA()),2&h){const d=M.$implicit;i.xp6(1),i.Q6J("ngForOf",d)}}function T(h,M){if(1&h){const d=i.EpF();i.TgZ(0,"div",15)(1,"app-warn-modal",16),i.NdJ("continue",function(b){i.CHM(d);const Z=i.oxw();return i.KtG(Z.onSubmit(b))}),i.qZA(),i.TgZ(2,"button",17),i.NdJ("click",function(){i.CHM(d);const b=i.oxw(),Z=i.MAs(1);return i.KtG(b.onReset(Z))}),i._uU(3," Reset "),i.qZA()()}if(2&h){const d=i.oxw();i.xp6(1),i.Q6J("btnMessage",d.btnMes)}}let y=(()=>{class h{constructor(d){this.cdref=d,this.formModel=new i.vpe,this.mode=!1,this.btnMes="Registrar",this.modalMessage="\xbf Desea continuar con este proceso ? ",this.formObj=[[new _.O("Nombre Completo","fullname","text"),new _.O("Nombre de Usuario","username","text")],[new _.O("Correo Electronico","email","text")],[new _.O("Password","password","password"),new _.O("Confirmar Password","Confirm Password","password")],[new _.O("Aceptar los Terminos","Accept Terms","radio","form-check-input",!1)]],this.continue=!1}ngOnInit(){}onContinue(d){this.continue=d}ngAfterContentChecked(){this.cdref.detectChanges()}onSubmit(d){if(this.continue&&d){var g={};this.formObj.flat(2).forEach(b=>g[b.label]=b.value),this.formModel.emit(g)}}onReset(d){this.continue=!1,d.reset()}}return h.\u0275fac=function(d){return new(d||h)(i.Y36(i.sBO))},h.\u0275cmp=i.Xpm({type:h,selectors:[["app-form"]],inputs:{mode:"mode",btnMes:"btnMes",modalMessage:"modalMessage",formObj:"formObj"},outputs:{formModel:"formModel"},decls:4,vars:2,consts:[["name","form","novalidate","",3,"ngSubmit"],["f","ngForm"],["class","input-group mb-2",4,"ngFor","ngForOf"],["class","form-group mt-3",4,"ngIf"],[1,"input-group","mb-2"],["class","form-floating",4,"ngFor","ngForOf"],[1,"form-floating"],["required","",3,"id","name","type","placeholder","ngModel","value","ngClass","readonly","ngModelChange"],["input","ngModel"],["class","invalid-feedback",4,"ngIf"],[1,"",3,"for"],["class","mb-4",4,"ngIf"],[1,"invalid-feedback"],[4,"ngIf"],[1,"mb-4"],[1,"form-group","mt-3"],["type","submit","modalMessage","\xbfSeguro que desea crear una nueva orden?",3,"btnMessage","continue"],["type","button",1,"ms-2","btn","btn-outline-danger","rounded-pill",3,"click"]],template:function(d,g){if(1&d){const b=i.EpF();i.TgZ(0,"form",0,1),i.NdJ("ngSubmit",function(){i.CHM(b);const A=i.MAs(1);return i.KtG(A.form.valid&&g.onContinue(!0))}),i.YNc(2,P,2,1,"div",2),i.YNc(3,T,4,1,"div",3),i.qZA()}2&d&&(i.xp6(2),i.Q6J("ngForOf",g.formObj),i.xp6(1),i.Q6J("ngIf",!g.mode))},dependencies:[x.mk,x.sg,x.O5,v._Y,v.Fj,v.JJ,v.JL,v.Q7,v.On,v.F,C]}),h})()},22:(q,w,l)=>{l.r(w),l.d(w,{ProductModule:()=>Y});var i=l(6895),_=l(9051),x=l(5861),v=l(4004),C=l(6535),t=l(4650),m=l(6082),s=l(433),c=l(8179),u=l(33);let P=(()=>{class n{constructor(e){this.db=e,this.dbPath="/FPreport",this.invFinishedProductsRef=e.collection(this.dbPath)}getNextBatch(e,r){return console.log("hi"),this.db.collection(this.dbPath,r?o=>o.orderBy("timestamp","desc").startAfter(r.timestamp).limit(e):o=>o.orderBy("timestamp","desc").limit(e))}getAll(){return this.invFinishedProductsRef}create(e){return this.invFinishedProductsRef.add({...e})}update(e,r){return this.invFinishedProductsRef.doc(e).update(r)}delete(e){return this.invFinishedProductsRef.doc(e).delete()}filterByNameBatch(e,r,o){return this.db.collection(this.dbPath,o?a=>a.where("name",">=",e).where("name","<=",e+"\uf8ff").orderBy("name","desc").startAfter(o.name).limit(r):a=>a.where("name",">=",e).where("name","<=",e+"\uf8ff").orderBy("name","desc").limit(r))}filterByCodeBatch(e,r,o){return this.db.collection(this.dbPath,o?a=>a.where("code",">=",e).where("code","<=",e+"\uf8ff").orderBy("code","desc").startAfter(o.code).limit(r):a=>a.where("code",">=",e).where("code","<=",e+"\uf8ff").orderBy("code","desc").limit(r))}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(u.ST))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function T(n,p){if(1&n){const e=t.EpF();t.TgZ(0,"div",2)(1,"h4"),t._uU(2,"Producto"),t.qZA(),t.TgZ(3,"form")(4,"div",3)(5,"input",4),t.NdJ("ngModelChange",function(o){t.CHM(e);const a=t.oxw();return t.KtG(a.currentProduct.name=o)}),t.qZA(),t.TgZ(6,"label",5),t._uU(7,"Nombre"),t.qZA()(),t.TgZ(8,"div",3)(9,"input",6),t.NdJ("ngModelChange",function(o){t.CHM(e);const a=t.oxw();return t.KtG(a.currentProduct.code=o)}),t.qZA(),t.TgZ(10,"label",7),t._uU(11,"Codigo"),t.qZA()(),t.TgZ(12,"div",3)(13,"input",8),t.NdJ("ngModelChange",function(o){t.CHM(e);const a=t.oxw();return t.KtG(a.currentProduct.description=o)}),t.qZA(),t.TgZ(14,"label",9),t._uU(15,"Descripcion"),t.qZA()(),t.TgZ(16,"div",3)(17,"input",10),t.NdJ("ngModelChange",function(o){t.CHM(e);const a=t.oxw();return t.KtG(a.currentProduct.leadTime=o)}),t.qZA(),t.TgZ(18,"label",11),t._uU(19,"Tiempo"),t.qZA()(),t.TgZ(20,"div",3)(21,"input",12),t.NdJ("ngModelChange",function(o){t.CHM(e);const a=t.oxw();return t.KtG(a.currentProduct.price=o)}),t.qZA(),t.TgZ(22,"label",13),t._uU(23,"Precio"),t.qZA()(),t.TgZ(24,"div",14)(25,"input",15),t.NdJ("ngModelChange",function(o){t.CHM(e);const a=t.oxw();return t.KtG(a.currentProduct.capacityByTurn=o)}),t.qZA(),t.TgZ(26,"label",16),t._uU(27,"Capacidad por turno"),t.qZA()(),t.TgZ(28,"div",14)(29,"input",17),t.NdJ("ngModelChange",function(o){t.CHM(e);const a=t.oxw();return t.KtG(a.income=o)}),t.qZA(),t.TgZ(30,"label",18),t._uU(31,"Ingreso"),t.qZA()(),t.TgZ(32,"div",14)(33,"input",19),t.NdJ("ngModelChange",function(o){t.CHM(e);const a=t.oxw();return t.KtG(a.currentProduct.stock=o)}),t.qZA(),t.TgZ(34,"label",20),t._uU(35,"Cantidad en Inventario"),t.qZA()()(),t.TgZ(36,"button",21),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.deleteProduct())}),t._uU(37," Eliminar "),t.qZA(),t.TgZ(38,"button",22),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.updateProduct())}),t._uU(39," Editar "),t.qZA(),t.TgZ(40,"button",23),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.updateProduct())}),t._uU(41," Materiales "),t.qZA(),t.TgZ(42,"p"),t._uU(43),t.qZA()()}if(2&n){const e=t.oxw();t.xp6(5),t.Q6J("ngModel",e.currentProduct.name),t.xp6(4),t.Q6J("ngModel",e.currentProduct.code),t.xp6(4),t.Q6J("ngModel",e.currentProduct.description),t.xp6(4),t.Q6J("ngModel",e.currentProduct.leadTime),t.xp6(4),t.Q6J("ngModel",e.currentProduct.price),t.xp6(4),t.Q6J("ngModel",e.currentProduct.capacityByTurn),t.xp6(4),t.Q6J("ngModel",e.income),t.xp6(4),t.Q6J("ngModel",e.currentProduct.stock),t.xp6(7),t.Q6J("state",e.currentProduct),t.xp6(3),t.Oqu(e.message)}}function y(n,p){1&n&&(t.TgZ(0,"div"),t._UZ(1,"br"),t.TgZ(2,"p"),t._uU(3,"No fue posible acceder a este producto..."),t.qZA()())}let h=(()=>{class n{constructor(e,r){this.productService=e,this.reportService=r,this.refreshList=new t.vpe,this.currentProduct={name:"",description:"",code:"",price:0,leadTime:0,stock:0,capacityByTurn:0},this.message="",this.income=0,this.outflow=0}ngOnInit(){this.message=""}ngOnChanges(){this.message="",this.currentProduct={...this.product}}createInventoryReport(){if(!this.income)return;const e={product_id:this.currentProduct.id,name:this.currentProduct.name,income:this.income,outcome:this.outflow,timestamp:c.EK.fromDate(new Date)};this.reportService.create(e)}updateProduct(){const e={name:this.currentProduct.name,code:this.currentProduct.code,description:this.currentProduct.description,price:this.currentProduct.price,leadTime:this.currentProduct.leadTime,stock:this.currentProduct.stock?this.currentProduct.stock+this.income:this.income,capacityByTurn:this.currentProduct.capacityByTurn};this.currentProduct.id&&this.productService.update(this.currentProduct.id,e).then(()=>{this.refreshList.emit(),this.message="The product was updated successfully!",this.currentProduct.stock=e.stock}).catch(r=>console.log(r))}deleteProduct(){this.currentProduct.id&&this.productService.delete(this.currentProduct.id).then(()=>{this.refreshList.emit(),this.message="The product was deleted successfully!"}).catch(e=>console.log(e))}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(m.M),t.Y36(P))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-product-details"]],inputs:{product:"product"},outputs:{refreshList:"refreshList"},features:[t.TTD],decls:2,vars:2,consts:[["class","edit-form",4,"ngIf"],[4,"ngIf"],[1,"edit-form"],[1,"form-floating","mb-2"],["type","text","id","name","required","","name","name","placeholder","Nombre","type","text",1,"form-control",3,"ngModel","ngModelChange"],["for","name"],["type","text","id","code","required","","name","code","placeholder","Codigo","type","text",1,"form-control",3,"ngModel","ngModelChange"],["for","code"],["id","description","required","","placeholder","description","name","description","type","text",1,"form-control",3,"ngModel","ngModelChange"],["for","description"],["id","leadTime","required","","placeholder","description","name","leadTime","type","number",1,"form-control",3,"ngModel","ngModelChange"],["for","leadTime"],["id","price","required","","placeholder","description","name","price","type","number",1,"form-control",3,"ngModel","ngModelChange"],["for","price"],[1,"form-floating","mb-3"],["id","capacityByTurn","required","","placeholder","description","name","capacityByTurn","type","number",1,"form-control",3,"ngModel","ngModelChange"],["for","capacityByTurn"],["id","income","required","","placeholder","description","name","income","type","number",1,"form-control",3,"ngModel","ngModelChange"],["for","income"],["id","stock","required","","placeholder","description","name","stock","type","number","readonly","",1,"form-control",3,"ngModel","ngModelChange"],["for","stock"],[1,"btn","btn-danger","rounded-pill",3,"click"],["type","submit",1,"btn","btn-success","rounded-pill","mx-2",3,"click"],["routerLink","material",1,"btn","btn-secondary","rounded-pill",3,"state","click"]],template:function(e,r){1&e&&(t.YNc(0,T,44,10,"div",0),t.YNc(1,y,4,0,"div",1)),2&e&&(t.Q6J("ngIf",r.currentProduct),t.xp6(1),t.Q6J("ngIf",!r.currentProduct))},dependencies:[i.O5,_.rH,s._Y,s.Fj,s.wV,s.JJ,s.JL,s.Q7,s.On,s.F]}),n})();function M(n,p){if(1&n){const e=t.EpF();t.TgZ(0,"li",27),t.NdJ("click",function(){const o=t.CHM(e),a=o.$implicit,f=o.index,B=t.oxw();return t.KtG(B.setActiveProduct(a,f))}),t._uU(1),t.qZA()}if(2&n){const e=p.$implicit,r=p.index,o=t.oxw();t.ekj("active",r==o.currentIndex),t.xp6(1),t.AsE(" ",e.name," - ",e.code," ")}}function d(n,p){if(1&n){const e=t.EpF();t.TgZ(0,"div")(1,"app-product-details",28),t.NdJ("refreshList",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.refreshList())}),t.qZA()()}if(2&n){const e=t.oxw();t.xp6(1),t.Q6J("product",e.currentProduct)}}function g(n,p){1&n&&(t.TgZ(0,"div"),t._UZ(1,"br"),t.TgZ(2,"p"),t._uU(3,"Seleccione un producto..."),t.qZA()())}let b=(()=>{class n{constructor(e,r){var o=this;this.ProductService=e,this.fos=r,this.currentIndex=-1,this.title="",this.query="",this.queryChange=void 0,this.codeFilter=!1,this.productsPerCall=2,this.disableNext=!1,this.disablePrev=!1,this.lastInResponses=[],this.data=function(){var a=(0,x.Z)(function*(f){const B=yield o.fos.nextPage(f);!B||(o.pagination=B,o.Products=o.pagination.requestDataArray,o.disableNext=o.pagination.disableNext,o.disablePrev=o.pagination.disablePrev,console.log(o.Products))});return function(f){return a.apply(this,arguments)}}(),this.pagination={query:void 0,filterType:!1,filterKey:"",productsPerCall:2,disableNext:!1,disablePrev:!0,lastInResponses:[],requestDataArray:[]}}ngOnInit(){this.fos.paginationSetter(this.pagination),this.nextPage(!0)}refreshList(){this.currentProduct=void 0,this.currentIndex=-1;var e=this.lastInResponses.splice(0,this.lastInResponses.length);this.nextPage(!0),console.log(this.lastInResponses,e)}nextPage(e){var r;if(e){if(this.disableNext)return;this.Products?.length&&this.pagination.lastInResponses?.push(this.Products[this.Products.length-1]),r=this.pagination.lastInResponses?.length?this.pagination.lastInResponses[this.pagination.lastInResponses?.length-1]:void 0}else{if(this.disablePrev)return;this.pagination.lastInResponses?.pop(),r=this.pagination.lastInResponses?.pop()}(this.pagination.query?this.fos.filterByKeyBatch(this.pagination.filterKey,this.pagination.query,this.pagination.productsPerCall,r):this.fos.getNextBatch(this.pagination.productsPerCall,r)).snapshotChanges().pipe((0,v.U)(a=>a.map(f=>({id:f.payload.doc.id,...f.payload.doc.data()})))).subscribe(a=>{if(!a.length)return this.disableNext=!0,void this.pagination.lastInResponses.pop();this.Products=a,this.disableNext=a.length<this.productsPerCall,this.disablePrev=!r})}filterProducts(){this.Products=[],this.lastInResponses=[],this.disableNext=!1,this.disablePrev=!0,this.pagination={query:this.query,filterKey:this.codeFilter?"code":"name",productsPerCall:2,disableNext:!1,disablePrev:!0,lastInResponses:[],requestDataArray:[]},this.nextPage(!0)}setActiveProduct(e,r){this.currentProduct=e,this.currentIndex=r}readableDate(e){var r=new Date(e);return r.getDate()+"/"+r.getMonth()+"/"+r.getFullYear()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(m.M),t.Y36(C.U))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-product-list"]],features:[t._Bn([C.U,{provide:"path",useValue:"/products"}])],decls:40,vars:5,consts:[[1,"container","mt-5","vh-100"],["role","search",1,"d-flex"],[1,"text-muted","text-nowrap"],[1,"ms-5","form-check"],["for","flexCheckDefault",1,"form-check-label"],["type","checkbox","id","flexCheckDefault","name","codeFilter",1,"form-check-input",3,"ngModel","ngModelChange"],["id","query","type","search","name","query","placeholder","Buscar por Nombre o Codigo","aria-label","Search",1,"form-control","ms-2","me-2","float-end",3,"ngModel","ngModelChange"],["type","submit",1,"btn","btn-outline-success","float-end",3,"click"],[1,"position-fixed","bottom-0","end-0",2,"margin","6rem","z-index","1070"],["routerLink","add",1,"btn","btn-success","btn-lg","rounded-pill"],["fill","#ffffff","version","1.1","id","Capa_1","xmlns","http://www.w3.org/2000/svg",0,"xmlns","xlink","http://www.w3.org/1999/xlink","width","4vh","height","4vh","viewBox","0 0 47 47",0,"xml","space","preserve","stroke","#ffffff"],["id","SVGRepo_bgCarrier","stroke-width","0"],["id","SVGRepo_tracerCarrier","stroke-linecap","round","stroke-linejoin","round"],["id","SVGRepo_iconCarrier"],["d","M41.267,18.557H26.832V4.134C26.832,1.851,24.99,0,22.707,0c-2.283,0-4.124,1.851-4.124,4.135v14.432H4.141 c-2.283,0-4.139,1.851-4.138,4.135c-0.001,1.141,0.46,2.187,1.207,2.934c0.748,0.749,1.78,1.222,2.92,1.222h14.453V41.27 c0,1.142,0.453,2.176,1.201,2.922c0.748,0.748,1.777,1.211,2.919,1.211c2.282,0,4.129-1.851,4.129-4.133V26.857h14.435 c2.283,0,4.134-1.867,4.133-4.15C45.399,20.425,43.548,18.557,41.267,18.557z"],[1,"list","row","shadow-sm"],[1,"col-md-6"],[1,"list-group","mt-3","mb-3"],["class","list-group-item",3,"active","click",4,"ngFor","ngForOf"],[4,"ngIf"],["aria-label","Page navigation",1,"mt-3"],[1,"pagination"],[1,"page-item"],["aria-label","Previous",1,"page-link",3,"click"],["aria-hidden","true"],[1,"page-link","text-black"],["aria-label","Next",1,"page-link",3,"click"],[1,"list-group-item",3,"click"],[3,"product","refreshList"]],template:function(e,r){1&e&&(t.TgZ(0,"div",0)(1,"form",1)(2,"h4",2),t._uU(3,"Lista de Productos"),t.qZA(),t.TgZ(4,"div",3)(5,"label",4),t._uU(6," Filtro por Codigo "),t.qZA(),t.TgZ(7,"input",5),t.NdJ("ngModelChange",function(a){return r.codeFilter=a}),t.qZA()(),t.TgZ(8,"input",6),t.NdJ("ngModelChange",function(a){return r.query=a}),t.qZA(),t.TgZ(9,"button",7),t.NdJ("click",function(){return r.filterProducts()}),t._uU(10,"Buscar"),t.qZA()(),t._UZ(11,"hr"),t.TgZ(12,"div",8)(13,"button",9),t.O4$(),t.TgZ(14,"svg",10),t._UZ(15,"g",11)(16,"g",12),t.TgZ(17,"g",13)(18,"g"),t._UZ(19,"path",14),t.qZA()()()()(),t.kcU(),t.TgZ(20,"div",15)(21,"div",16)(22,"ul",17),t.YNc(23,M,2,4,"li",18),t.qZA()(),t.TgZ(24,"div",16),t.YNc(25,d,2,1,"div",19),t.YNc(26,g,4,0,"div",19),t.qZA()(),t.TgZ(27,"nav",20)(28,"ul",21)(29,"li",22)(30,"button",23),t.NdJ("click",function(){return r.nextPage(!1)}),t.TgZ(31,"span",24),t._uU(32,"\xab"),t.qZA()()(),t.TgZ(33,"li",22)(34,"span",25),t._uU(35," Anterior/Siguiente Registro"),t.qZA()(),t.TgZ(36,"li",22)(37,"button",26),t.NdJ("click",function(){return r.nextPage(!0)}),t.TgZ(38,"span",24),t._uU(39,"\xbb"),t.qZA()()()()()()),2&e&&(t.xp6(7),t.Q6J("ngModel",r.codeFilter),t.xp6(1),t.Q6J("ngModel",r.query),t.xp6(15),t.Q6J("ngForOf",r.Products),t.xp6(2),t.Q6J("ngIf",r.currentProduct),t.xp6(1),t.Q6J("ngIf",!r.currentProduct))},dependencies:[i.sg,i.O5,_.rH,s._Y,s.Fj,s.Wl,s.JJ,s.JL,s.On,s.F,h]}),n})();class Z{}var A=l(4985),N=l(798),F=l(4245);function k(n,p){if(1&n){const e=t.EpF();t.TgZ(0,"div")(1,"div",4)(2,"div",5)(3,"app-form",6),t.NdJ("formModel",function(o){t.CHM(e);const a=t.oxw();return t.KtG(a.submit(o))}),t.qZA()()()()}if(2&n){const e=t.oxw();t.xp6(3),t.Q6J("formObj",e.formObj)}}function I(n,p){if(1&n){const e=t.EpF();t.TgZ(0,"div",7)(1,"h4"),t._uU(2,"El producto a sido registrado Satisfactoriamente!"),t.qZA(),t.TgZ(3,"button",8),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.newProduct())}),t._uU(4,"A\xf1adir Otro"),t.qZA()()}}let J=(()=>{class n{constructor(e,r,o){this.ProductService=e,this.auditService=r,this.fos=o,this.product=new Z,this.submitted=!1,this.round=f=>Math.round(100*f)/100;var a=new A.O("Capacidad por turno","capacityByTurn","number");this.formObj=[[new A.O("Nombre","name","text"),new A.O("Codigo","code","text")],[new A.O("Descripcion","description","text")],[new A.O("Precio","price","number")],[new A.O("Cantidad en Inventario","stock","number")],[a,new A.O("Tiempo de Produccion","leadTime","number","",f=>f?this.round(1/f):0,[a],0)]]}submit(e){this.product=e,this.saveProduct()}saveProduct(){this.product.timestamp=c.EK.fromDate(new Date),this.fos.create(this.product).then(()=>{this.submitted=!0})}newProduct(){this.submitted=!1,this.product=new Z}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(m.M),t.Y36(N.C),t.Y36(C.U))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-add-product"]],features:[t._Bn([C.U,{provide:"path",useValue:"/products"}])],decls:6,vars:2,consts:[[1,"container","vh-100"],[1,"text-muted","mt-5"],[4,"ngIf"],["class","mt-3",4,"ngIf"],[1,"card","mt-4","bg-light","shadow-lg","border-0"],[1,"card-body"],["btnMes","Crear Producto","modalMessage","\xbfDesea continuar con la creacion del producto?",3,"formObj","formModel"],[1,"mt-3"],[1,"btn","btn-outline-success","mt-2",3,"click"]],template:function(e,r){1&e&&(t.TgZ(0,"div",0)(1,"h5",1),t._uU(2," Registro del Producto"),t.qZA(),t._UZ(3,"hr"),t.YNc(4,k,4,1,"div",2),t.YNc(5,I,5,0,"div",3),t.qZA()),2&e&&(t.xp6(4),t.Q6J("ngIf",!r.submitted),t.xp6(1),t.Q6J("ngIf",r.submitted))},dependencies:[i.O5,F.U]}),n})();var U=l(3985);let R=(()=>{class n{constructor(e){this.db=e,this.dbPath="/bom",this.bomRef=e.collection(this.dbPath)}getNextBatch(e,r){return this.db.collection(this.dbPath,r?o=>o.orderBy("timestamp","desc").startAfter(r).limit(e):o=>o.orderBy("timestamp","desc").limit(e))}getPrevBatch(e,r,o){return this.db.collection(this.dbPath,a=>a.orderBy("timestamp","desc").startAt(r).endBefore(o).limit(e))}getBatch(e){return this.db.collection(this.dbPath,r=>r.limit(e).orderBy("timestamp","desc"))}getAll(){return this.bomRef}getById(e){return this.db.collection(this.dbPath,r=>r.where("product_id","==",e))}create(e){return this.bomRef.add({...e})}update(e,r){return this.bomRef.doc(e).update(r)}delete(e){return this.bomRef.doc(e).delete()}filterByName(e){return this.db.collection(this.dbPath,r=>r.where("name",">=",e).where("name","<=",e+"\uf8ff"))}filterByCode(e){return this.db.collection(this.dbPath,r=>r.where("code",">=",e).where("code","<=",e+"\uf8ff"))}filterByCodeBatch(e,r,o){return this.db.collection(this.dbPath,o?a=>a.where("code",">=",e).where("code","<=",e+"\uf8ff").orderBy("code","desc").startAfter(o.code).limit(r):a=>a.where("code",">=",e).where("code","<=",e+"\uf8ff").orderBy("code","desc").limit(r))}filterByNameBatch(e,r,o){return this.db.collection(this.dbPath,o?a=>a.where("name",">=",e).where("name","<=",e+"\uf8ff").orderBy("name","desc").startAfter(o.name).limit(r):a=>a.where("name",">=",e).where("name","<=",e+"\uf8ff").orderBy("name","desc").limit(r))}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(u.ST))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function O(n,p){if(1&n){const e=t.EpF();t.TgZ(0,"li",21),t.NdJ("click",function(){const o=t.CHM(e),a=o.$implicit,f=o.index,B=t.oxw();return t.KtG(B.setActiveMaterial(a,f))}),t._uU(1),t.TgZ(2,"button",22),t.NdJ("click",function(){const a=t.CHM(e).$implicit,f=t.oxw();return t.KtG(f.addMaterialToProduct(a))}),t.TgZ(3,"span"),t.O4$(),t.TgZ(4,"svg",23),t._UZ(5,"g",24)(6,"g",25),t.TgZ(7,"g",26)(8,"g")(9,"g"),t._UZ(10,"path",27),t.qZA()()()()()()()}if(2&n){const e=p.$implicit,r=p.index,o=t.oxw();t.ekj("active",r==o.currentIndex),t.xp6(1),t.hij(" ",e.name," ")}}function D(n,p){if(1&n){const e=t.EpF();t.TgZ(0,"li",32)(1,"div",33)(2,"div",34),t._uU(3),t.qZA(),t.TgZ(4,"div",35)(5,"input",36),t.NdJ("ngModelChange",function(o){const f=t.CHM(e).$implicit;return t.KtG(f.quantity=o)}),t.qZA(),t.TgZ(6,"span",37),t._uU(7,"U"),t.qZA()(),t.TgZ(8,"button",38),t.NdJ("click",function(){const a=t.CHM(e).index,f=t.oxw(2);return t.KtG(f.removeMaterialToProduct(a))}),t.qZA()()()}if(2&n){const e=p.$implicit;t.xp6(3),t.hij(" ",e.name," "),t.xp6(2),t.Q6J("ngModel",e.quantity)}}function S(n,p){if(1&n){const e=t.EpF();t.TgZ(0,"div",28)(1,"h4"),t._uU(2,"Producto"),t.qZA(),t.TgZ(3,"h3",29),t._uU(4),t.qZA(),t.TgZ(5,"p"),t._uU(6,"Materiales del Producto: "),t.qZA(),t.TgZ(7,"ul",10),t.YNc(8,D,9,2,"li",30),t.qZA(),t.TgZ(9,"button",31),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.editMaterials())}),t._uU(10," Agregar Matriales "),t.qZA()()}if(2&n){const e=t.oxw();t.xp6(4),t.AsE("",e.product.name," - ",e.product.code,""),t.xp6(4),t.Q6J("ngForOf",e.productMaterials)}}function L(n,p){1&n&&(t.TgZ(0,"div"),t._UZ(1,"br"),t.TgZ(2,"p"),t._uU(3,"No fue posible acceder a este producto..."),t.qZA()())}function E(n,p){1&n&&(t.TgZ(0,"div"),t._UZ(1,"br"),t.TgZ(2,"p"),t._uU(3,"Seleccione un producto..."),t.qZA()())}const K=[{path:"",component:b},{path:"add",component:J},{path:"material",component:(()=>{class n{constructor(e,r,o,a){this.MaterialService=e,this.bomService=r,this.productService=o,this.router=a,this.rL=new t.vpe,this.currentIndex=-1,this.title="",this.query="",this.queryChange=void 0,this.areaFilter="",this.id="",this.productsPerCall=2,this.lastInResponses=[],this.disableNext=!1,this.disablePrev=!0,this.updateMaterials=!1,this.productMaterials=[]}ngOnInit(){this.product=history.state,this.getProductMaterials(),this.nextPage(!0)}getProductMaterials(){!this.product?.id||this.productService.getById(this.product?.id).pipe((0,v.U)(e=>({id:e.id,prod:e.data()}))).subscribe(e=>{!e||(console.log(e,e.prod,e.id),this.product=e.prod,this.product.id=e.id,this.productMaterials=e.prod?.productMaterials?e.prod?.productMaterials:[])})}nextPage(e){var r,o;if(console.log(this.disablePrev),e){if(this.disableNext)return;this.Materials?.length&&this.lastInResponses?.push(this.Materials[this.Materials.length-1]),r=this.lastInResponses?.length?this.lastInResponses[this.lastInResponses?.length-1]:void 0}else{if(this.disablePrev)return;this.lastInResponses?.pop(),r=this.lastInResponses?.pop()}console.log("Info:",r,this.lastInResponses,this.queryChange),this.queryChange?this.areaFilter?o=this.MaterialService.filterByAreaBatch(this.queryChange,this.productsPerCall,r):(console.log(this.queryChange),o=this.MaterialService.filterByNameBatch(this.queryChange,this.productsPerCall,r)):o=this.MaterialService.getNextBatch(this.productsPerCall,r),o.snapshotChanges().pipe((0,v.U)(a=>a.map(f=>({id:f.payload.doc.id,...f.payload.doc.data()})))).subscribe(a=>{a.length?(console.log(a),this.Materials=a,this.disableNext=a.length<this.productsPerCall,this.disablePrev=!r):this.disableNext=!0},a=>{this.disableNext=!1})}refreshList(){this.currentMaterial=void 0,this.currentIndex=-1,this.retrieveMaterials()}retrieveMaterials(){this.MaterialService.getAll().snapshotChanges().pipe((0,v.U)(e=>e.map(r=>({id:r.payload.doc.id,...r.payload.doc.data()})))).subscribe(e=>{this.Materials=e})}filterMaterials(){this.queryChange=this.query,this.Materials=[],this.lastInResponses=[],this.nextPage(!0)}setActiveMaterial(e,r){this.currentMaterial=e,this.currentIndex=r}addMaterialToProduct(e){this.productMaterials.find(o=>o.id==e.id)||this.productMaterials.push({name:e.name,id:e.id,deliveryTime:e.deliveryTime,minBatch:e.minBatch})}removeMaterialToProduct(e){this.productMaterials.splice(e,1)}getMaterialWaitMaxTime(){return Math.max(...this.productMaterials.map(e=>e.deliveryTime))}editMaterials(){if(this.product&&this.productMaterials){var e={MaxWaitTime:this.getMaterialWaitMaxTime(),materials:this.productMaterials.map(r=>({id:r.id,name:r.name,quantity:r.quantity,minBatch:r.minBatch}))};this.productService.update(this.product?.id,e).then(()=>{alert("Materiales Actualizados Satisfactoriamente"),this.router.navigate(["products"])})}}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(U.U),t.Y36(R),t.Y36(m.M),t.Y36(_.F0))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-product-materials"]],inputs:{product:"product"},outputs:{rL:"rL"},decls:33,vars:6,consts:[[1,"container","mt-5","vh-100"],["role","search",1,"d-flex"],[1,"text-muted","text-nowrap"],[1,"ms-5","form-check"],["for","flexCheckDefault",1,"form-check-label"],["type","checkbox","id","flexCheckDefault","name","areaFilter",1,"form-check-input",3,"ngModel","ngModelChange"],["type","search","name","query","placeholder","Buscar por Nombre o Area","aria-label","Search",1,"form-control","ms-2","me-2","float-end",3,"ngModel","ngModelChange"],["type","submit",1,"btn","btn-outline-success","float-end",3,"click"],[1,"list","row","shadow-sm"],[1,"col-md-6"],[1,"list-group","mt-3","mb-3"],["class","list-group-item",3,"active","click",4,"ngFor","ngForOf"],["class","edit-form",4,"ngIf"],[4,"ngIf"],["aria-label","Page navigation",1,"mt-3"],[1,"pagination"],[1,"page-item"],["aria-label","Previous",1,"page-link",3,"click"],["aria-hidden","true"],[1,"page-link","text-black"],["aria-label","Next",1,"page-link",3,"click"],[1,"list-group-item",3,"click"],[1,"btn","btn-success","btn-sm","rounded-pill","float-end",3,"click"],["fill","#ffffff","version","1.1","id","Capa_1","xmlns","http://www.w3.org/2000/svg",0,"xmlns","xlink","http://www.w3.org/1999/xlink","width","20px","height","20px","viewBox","0 0 533.973 533.973",0,"xml","space","preserve"],["id","SVGRepo_bgCarrier","stroke-width","0"],["id","SVGRepo_tracerCarrier","stroke-linecap","round","stroke-linejoin","round"],["id","SVGRepo_iconCarrier"],["d","M477.931,52.261c-12.821-12.821-33.605-12.821-46.427,0l-266.96,266.954l-62.075-62.069 c-12.821-12.821-33.604-12.821-46.426,0L9.616,303.572c-12.821,12.821-12.821,33.604,0,46.426l85.289,85.289l46.426,46.426 c12.821,12.821,33.611,12.821,46.426,0l46.426-46.426l290.173-290.174c12.821-12.821,12.821-33.605,0-46.426L477.931,52.261z"],[1,"edit-form"],[1,"text-muted"],["class","list-group-item",4,"ngFor","ngForOf"],["type","submit",1,"btn","btn-success","mb-2","rounded-pill",3,"click"],[1,"list-group-item"],[1,"d-flex","flex-row","justify-content-between"],[1,"my-auto"],[1,"input-group","mx-auto","h-25","w-50"],["type","number","placeholder","Unidades por Producto","name","UP","aria-label","quantity",1,"form-control","input-sm",3,"ngModel","ngModelChange"],[1,"input-group-text"],[1,"btn-close","my-auto","btn-sm","rounded-pill","float-end",3,"click"]],template:function(e,r){1&e&&(t.TgZ(0,"div",0)(1,"form",1)(2,"h4",2),t._uU(3,"Lista de Materiales del Producto"),t.qZA(),t.TgZ(4,"div",3)(5,"label",4),t._uU(6," Filtro por Area "),t.qZA(),t.TgZ(7,"input",5),t.NdJ("ngModelChange",function(a){return r.areaFilter=a}),t.qZA()(),t.TgZ(8,"input",6),t.NdJ("ngModelChange",function(a){return r.query=a}),t.qZA(),t.TgZ(9,"button",7),t.NdJ("click",function(){return r.filterMaterials()}),t._uU(10,"Buscar"),t.qZA()(),t._UZ(11,"hr"),t.TgZ(12,"div",8)(13,"div",9)(14,"ul",10),t.YNc(15,O,11,3,"li",11),t.qZA()(),t.TgZ(16,"div",9),t.YNc(17,S,11,3,"div",12),t.YNc(18,L,4,0,"div",13),t.YNc(19,E,4,0,"div",13),t.qZA()(),t.TgZ(20,"nav",14)(21,"ul",15)(22,"li",16)(23,"button",17),t.NdJ("click",function(){return r.nextPage(!1)}),t.TgZ(24,"span",18),t._uU(25,"\xab"),t.qZA()()(),t.TgZ(26,"li",16)(27,"span",19),t._uU(28," Anterior/Siguiente Registro"),t.qZA()(),t.TgZ(29,"li",16)(30,"button",20),t.NdJ("click",function(){return r.nextPage(!0)}),t.TgZ(31,"span",18),t._uU(32,"\xbb"),t.qZA()()()()()()),2&e&&(t.xp6(7),t.Q6J("ngModel",r.areaFilter),t.xp6(1),t.Q6J("ngModel",r.query),t.xp6(7),t.Q6J("ngForOf",r.Materials),t.xp6(2),t.Q6J("ngIf",r.product),t.xp6(1),t.Q6J("ngIf",!r.product),t.xp6(1),t.Q6J("ngIf",!r.product))},dependencies:[i.sg,i.O5,s._Y,s.Fj,s.wV,s.Wl,s.JJ,s.JL,s.On,s.F]}),n})()}];let j=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[_.Bz.forChild(K),_.Bz]}),n})();var Q=l(4466);let Y=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[i.ez,j,Q.m]}),n})()},798:(q,w,l)=>{l.d(w,{C:()=>v});var i=l(8179),_=l(4650),x=l(33);let v=(()=>{class C{constructor(m){this.db=m,this.dbPath="/audit",this.objectsRef=m.collection(this.dbPath)}getNextBatch(m,s){return this.db.collection(this.dbPath,s?c=>c.orderBy("timestamp","desc").startAfter(s.timestamp).limit(m):c=>c.orderBy("timestamp","desc").limit(m))}create(m,s,c){var u={operation:m,process:s,timestamp:i.EK.fromDate(new Date),user:c};return console.log(u),this.objectsRef.add({...u})}update(m,s){return this.objectsRef.doc(m).update(s)}delete(m){return this.objectsRef.doc(m).delete()}filterByDateBatch(m,s,c,u,P){return console.log(c),this.db.collection(this.dbPath,T=>T.where("timestamp",">=",m).where("timestamp","<=",s).where("name","==",c).orderBy("timestamp","desc").limit(u))}filterByNameBatch(m,s,c){return this.db.collection(this.dbPath,c?u=>u.where("name",">=",m).where("name","<=",m+"\uf8ff").orderBy("name","desc").startAfter(c.name).limit(s):u=>u.where("name",">=",m).where("name","<=",m+"\uf8ff").orderBy("name","desc").limit(s))}filterByCodeBatch(m,s,c){return this.db.collection(this.dbPath,c?u=>u.where("code",">=",m).where("code","<=",m+"\uf8ff").orderBy("code","desc").startAfter(c.code).limit(s):u=>u.where("code",">=",m).where("code","<=",m+"\uf8ff").orderBy("code","desc").limit(s))}}return C.\u0275fac=function(m){return new(m||C)(_.LFG(x.ST))},C.\u0275prov=_.Yz7({token:C,factory:C.\u0275fac,providedIn:"root"}),C})()},6535:(q,w,l)=>{l.d(w,{U:()=>C});var i=l(5861),_=l(4004),x=l(4650),v=l(33);let C=(()=>{class t{constructor(s,c){this.db=s,this.path=c,this.objectRef=s.collection(this.path),this.pagination={query:void 0,filterType:!1,filterKey:"",productsPerCall:2,disableNext:!1,disablePrev:!0,lastInResponses:[],requestDataArray:[]}}pathSetter(s){this.path=s,this.objectRef=this.db.collection(this.path)}paginationSetter(s){return this.pagination=s,this}paginationGetter(){return this.pagination}nextPage(s){var c=this;return(0,i.Z)(function*(){var u,P;if(console.log(c.pagination.disablePrev),s){if(c.pagination.disableNext)return;c.pagination.requestDataArray.length&&c.pagination.lastInResponses?.push(c.pagination.requestDataArray[c.pagination.requestDataArray.length-1]),u=c.pagination.lastInResponses?.length?c.pagination.lastInResponses[c.pagination.lastInResponses?.length-1]:void 0,console.log(u)}else{if(c.pagination.disablePrev)return;c.pagination.lastInResponses?.pop(),u=c.pagination.lastInResponses?.pop()}return console.log("Info:",u,c.pagination.lastInResponses,c.pagination.productsPerCall,c.pagination.query),P=c.pagination.query?c.filterByNameBatch(c.pagination.query,c.pagination.productsPerCall,u):c.getNextBatch(c.pagination.productsPerCall,u),new Promise(T=>{P.snapshotChanges().pipe((0,_.U)(y=>y.map(h=>({id:h.payload.doc.id,...h.payload.doc.data()})))).subscribe({next:y=>{if(!y.length)return c.pagination.disableNext=!0,void c.pagination.lastInResponses.pop();console.log(y),c.pagination.requestDataArray=y,c.pagination.disableNext=y.length<c.pagination.productsPerCall,c.pagination.disablePrev=!u,T(c.pagination)},error:y=>{c.pagination.disableNext=!1}})})})()}getNextBatch(s,c){return this.db.collection(this.path,c?u=>u.orderBy("timestamp","desc").startAfter(c.timestamp).limit(s):u=>u.orderBy("timestamp","desc").limit(s))}getAll(){return this.objectRef}getByKey(s,c){return this.db.collection(this.path,u=>u.where(s,"==",c))}create(s){return this.objectRef.add({...s})}update(s,c){return this.objectRef.doc(s).update(c)}delete(s){return this.objectRef.doc(s).delete()}filterByNameBatch(s,c,u){return u?this.db.collection(this.path,P=>P.where("name",">=",s).where("name","<=",s+"\uf8ff").orderBy("name","desc").startAfter(u.name).limit(c)):(this.pagination.lastInResponses=[],this.pagination.requestDataArray=[],this.pagination.disableNext=!1,this.pagination.disablePrev=!0,this.db.collection(this.path,P=>P.where("name",">=",s).where("name","<=",s+"\uf8ff").orderBy("name","desc").limit(c)))}filterByKeyBatch(s,c,u,P){return console.log(s,c),P?(console.log(P[s]),this.db.collection(this.path,T=>T.where(s,">=",c).where(s,"<=",c+"\uf8ff").orderBy(s,"desc").startAfter(P[s]).limit(u))):this.db.collection(this.path,T=>T.where(s,">=",c).where(s,"<=",c+"\uf8ff").orderBy(s,"desc").limit(u))}}return t.\u0275fac=function(s){return new(s||t)(x.LFG(v.ST),x.LFG("path"))},t.\u0275prov=x.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},8179:(q,w,l)=>{l.d(w,{EK:()=>i.EK});var i=l(2810)}}]);