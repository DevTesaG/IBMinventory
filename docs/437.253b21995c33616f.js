"use strict";(self.webpackChunkInvFurniture=self.webpackChunkInvFurniture||[]).push([[437],{5437:(Qe,B,l)=>{l.r(B),l.d(B,{OrdersModule:()=>Ge});var f=l(6895),O=l(2827),L=l(1350),v=l(8996),C=l(5577),q=l(5698),S=l(3900),N=l(6451),M=l(8505),p=l(4985),e=l(4650),j=l(8132),Z=l(9898),X=l(490),z=l(7886),$=l(1402),T=l(4004),R=l(8179),oe=l(33),G=l(9646),se=l(4351),ie=l(9300);class ae{}class y{constructor(n){this.normalizedNames=new Map,this.lazyUpdate=null,n?this.lazyInit="string"==typeof n?()=>{this.headers=new Map,n.split("\n").forEach(t=>{const r=t.indexOf(":");if(r>0){const o=t.slice(0,r),i=o.toLowerCase(),a=t.slice(r+1).trim();this.maybeSetNormalizedName(o,i),this.headers.has(i)?this.headers.get(i).push(a):this.headers.set(i,[a])}})}:()=>{this.headers=new Map,Object.keys(n).forEach(t=>{let r=n[t];const o=t.toLowerCase();"string"==typeof r&&(r=[r]),r.length>0&&(this.headers.set(o,r),this.maybeSetNormalizedName(t,o))})}:this.headers=new Map}has(n){return this.init(),this.headers.has(n.toLowerCase())}get(n){this.init();const t=this.headers.get(n.toLowerCase());return t&&t.length>0?t[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(n){return this.init(),this.headers.get(n.toLowerCase())||null}append(n,t){return this.clone({name:n,value:t,op:"a"})}set(n,t){return this.clone({name:n,value:t,op:"s"})}delete(n,t){return this.clone({name:n,value:t,op:"d"})}maybeSetNormalizedName(n,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,n)}init(){this.lazyInit&&(this.lazyInit instanceof y?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(n=>this.applyUpdate(n)),this.lazyUpdate=null))}copyFrom(n){n.init(),Array.from(n.headers.keys()).forEach(t=>{this.headers.set(t,n.headers.get(t)),this.normalizedNames.set(t,n.normalizedNames.get(t))})}clone(n){const t=new y;return t.lazyInit=this.lazyInit&&this.lazyInit instanceof y?this.lazyInit:this,t.lazyUpdate=(this.lazyUpdate||[]).concat([n]),t}applyUpdate(n){const t=n.name.toLowerCase();switch(n.op){case"a":case"s":let r=n.value;if("string"==typeof r&&(r=[r]),0===r.length)return;this.maybeSetNormalizedName(n.name,t);const o=("a"===n.op?this.headers.get(t):void 0)||[];o.push(...r),this.headers.set(t,o);break;case"d":const i=n.value;if(i){let a=this.headers.get(t);if(!a)return;a=a.filter(c=>-1===i.indexOf(c)),0===a.length?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,a)}else this.headers.delete(t),this.normalizedNames.delete(t)}}forEach(n){this.init(),Array.from(this.normalizedNames.keys()).forEach(t=>n(this.normalizedNames.get(t),this.headers.get(t)))}}class de{encodeKey(n){return Q(n)}encodeValue(n){return Q(n)}decodeKey(n){return decodeURIComponent(n)}decodeValue(n){return decodeURIComponent(n)}}const ce=/%(\d[a-f0-9])/gi,ue={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function Q(s){return encodeURIComponent(s).replace(ce,(n,t)=>ue[t]??n)}function A(s){return`${s}`}class b{constructor(n={}){if(this.updates=null,this.cloneFrom=null,this.encoder=n.encoder||new de,n.fromString){if(n.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function le(s,n){const t=new Map;return s.length>0&&s.replace(/^\?/,"").split("&").forEach(o=>{const i=o.indexOf("="),[a,c]=-1==i?[n.decodeKey(o),""]:[n.decodeKey(o.slice(0,i)),n.decodeValue(o.slice(i+1))],d=t.get(a)||[];d.push(c),t.set(a,d)}),t}(n.fromString,this.encoder)}else n.fromObject?(this.map=new Map,Object.keys(n.fromObject).forEach(t=>{const r=n.fromObject[t],o=Array.isArray(r)?r.map(A):[A(r)];this.map.set(t,o)})):this.map=null}has(n){return this.init(),this.map.has(n)}get(n){this.init();const t=this.map.get(n);return t?t[0]:null}getAll(n){return this.init(),this.map.get(n)||null}keys(){return this.init(),Array.from(this.map.keys())}append(n,t){return this.clone({param:n,value:t,op:"a"})}appendAll(n){const t=[];return Object.keys(n).forEach(r=>{const o=n[r];Array.isArray(o)?o.forEach(i=>{t.push({param:r,value:i,op:"a"})}):t.push({param:r,value:o,op:"a"})}),this.clone(t)}set(n,t){return this.clone({param:n,value:t,op:"s"})}delete(n,t){return this.clone({param:n,value:t,op:"d"})}toString(){return this.init(),this.keys().map(n=>{const t=this.encoder.encodeKey(n);return this.map.get(n).map(r=>t+"="+this.encoder.encodeValue(r)).join("&")}).filter(n=>""!==n).join("&")}clone(n){const t=new b({encoder:this.encoder});return t.cloneFrom=this.cloneFrom||this,t.updates=(this.updates||[]).concat(n),t}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(n=>this.map.set(n,this.cloneFrom.map.get(n))),this.updates.forEach(n=>{switch(n.op){case"a":case"s":const t=("a"===n.op?this.map.get(n.param):void 0)||[];t.push(A(n.value)),this.map.set(n.param,t);break;case"d":if(void 0===n.value){this.map.delete(n.param);break}{let r=this.map.get(n.param)||[];const o=r.indexOf(A(n.value));-1!==o&&r.splice(o,1),r.length>0?this.map.set(n.param,r):this.map.delete(n.param)}}}),this.cloneFrom=this.updates=null)}}class pe{constructor(){this.map=new Map}set(n,t){return this.map.set(n,t),this}get(n){return this.map.has(n)||this.map.set(n,n.defaultValue()),this.map.get(n)}delete(n){return this.map.delete(n),this}has(n){return this.map.has(n)}keys(){return this.map.keys()}}function V(s){return typeof ArrayBuffer<"u"&&s instanceof ArrayBuffer}function K(s){return typeof Blob<"u"&&s instanceof Blob}function Y(s){return typeof FormData<"u"&&s instanceof FormData}class P{constructor(n,t,r,o){let i;if(this.url=t,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=n.toUpperCase(),function he(s){switch(s){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||o?(this.body=void 0!==r?r:null,i=o):i=r,i&&(this.reportProgress=!!i.reportProgress,this.withCredentials=!!i.withCredentials,i.responseType&&(this.responseType=i.responseType),i.headers&&(this.headers=i.headers),i.context&&(this.context=i.context),i.params&&(this.params=i.params)),this.headers||(this.headers=new y),this.context||(this.context=new pe),this.params){const a=this.params.toString();if(0===a.length)this.urlWithParams=t;else{const c=t.indexOf("?");this.urlWithParams=t+(-1===c?"?":c<t.length-1?"&":"")+a}}else this.params=new b,this.urlWithParams=t}serializeBody(){return null===this.body?null:V(this.body)||K(this.body)||Y(this.body)||function me(s){return typeof URLSearchParams<"u"&&s instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof b?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||Y(this.body)?null:K(this.body)?this.body.type||null:V(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof b?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(n={}){const t=n.method||this.method,r=n.url||this.url,o=n.responseType||this.responseType,i=void 0!==n.body?n.body:this.body,a=void 0!==n.withCredentials?n.withCredentials:this.withCredentials,c=void 0!==n.reportProgress?n.reportProgress:this.reportProgress;let d=n.headers||this.headers,m=n.params||this.params;const E=n.context??this.context;return void 0!==n.setHeaders&&(d=Object.keys(n.setHeaders).reduce((_,g)=>_.set(g,n.setHeaders[g]),d)),n.setParams&&(m=Object.keys(n.setParams).reduce((_,g)=>_.set(g,n.setParams[g]),m)),new P(t,r,i,{params:m,headers:d,context:E,reportProgress:c,responseType:o,withCredentials:a})}}var h=(()=>((h=h||{})[h.Sent=0]="Sent",h[h.UploadProgress=1]="UploadProgress",h[h.ResponseHeader=2]="ResponseHeader",h[h.DownloadProgress=3]="DownloadProgress",h[h.Response=4]="Response",h[h.User=5]="User",h))();class I extends class fe{constructor(n,t=200,r="OK"){this.headers=n.headers||new y,this.status=void 0!==n.status?n.status:t,this.statusText=n.statusText||r,this.url=n.url||null,this.ok=this.status>=200&&this.status<300}}{constructor(n={}){super(n),this.type=h.Response,this.body=void 0!==n.body?n.body:null}clone(n={}){return new I({body:void 0!==n.body?n.body:this.body,headers:n.headers||this.headers,status:void 0!==n.status?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}}function D(s,n){return{body:n,headers:s.headers,context:s.context,observe:s.observe,params:s.params,reportProgress:s.reportProgress,responseType:s.responseType,withCredentials:s.withCredentials}}let ge=(()=>{class s{constructor(t){this.handler=t}request(t,r,o={}){let i;if(t instanceof P)i=t;else{let d,m;d=o.headers instanceof y?o.headers:new y(o.headers),o.params&&(m=o.params instanceof b?o.params:new b({fromObject:o.params})),i=new P(t,r,void 0!==o.body?o.body:null,{headers:d,context:o.context,params:m,reportProgress:o.reportProgress,responseType:o.responseType||"json",withCredentials:o.withCredentials})}const a=(0,G.of)(i).pipe((0,se.b)(d=>this.handler.handle(d)));if(t instanceof P||"events"===o.observe)return a;const c=a.pipe((0,ie.h)(d=>d instanceof I));switch(o.observe||"body"){case"body":switch(i.responseType){case"arraybuffer":return c.pipe((0,T.U)(d=>{if(null!==d.body&&!(d.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return d.body}));case"blob":return c.pipe((0,T.U)(d=>{if(null!==d.body&&!(d.body instanceof Blob))throw new Error("Response is not a Blob.");return d.body}));case"text":return c.pipe((0,T.U)(d=>{if(null!==d.body&&"string"!=typeof d.body)throw new Error("Response is not a string.");return d.body}));default:return c.pipe((0,T.U)(d=>d.body))}case"response":return c;default:throw new Error(`Unreachable: unhandled observe type ${o.observe}}`)}}delete(t,r={}){return this.request("DELETE",t,r)}get(t,r={}){return this.request("GET",t,r)}head(t,r={}){return this.request("HEAD",t,r)}jsonp(t,r){return this.request("JSONP",t,{params:(new b).append(r,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(t,r={}){return this.request("OPTIONS",t,r)}patch(t,r,o={}){return this.request("PATCH",t,D(o,r))}post(t,r,o={}){return this.request("POST",t,D(o,r))}put(t,r,o={}){return this.request("PUT",t,D(o,r))}}return s.\u0275fac=function(t){return new(t||s)(e.LFG(ae))},s.\u0275prov=e.Yz7({token:s,factory:s.\u0275fac}),s})(),ye=(()=>{class s{constructor(t,r){this.db=t,this.ht=r,this.dbPath="/finishedOrders",this.productsRef=t.collection(this.dbPath)}getById(t){return this.productsRef.doc(t).get()}getAll(){return this.productsRef}create(t){return this.productsRef.add({...t})}downloadFile(t,r=`Ordenes Terminadas_${(new Date).toLocaleString("es-MX")}`){console.log(t);let o=this.ConvertToCSV(t,Object.keys(t[0]));console.log(o);let i=new Blob(["\ufeff"+o],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a"),c=URL.createObjectURL(i);-1!=navigator.userAgent.indexOf("Safari")&&-1==navigator.userAgent.indexOf("Chrome")&&a.setAttribute("target","_blank"),a.setAttribute("href",c),a.setAttribute("download",r+".csv"),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a)}ConvertToCSV(t,r){let o="object"!=typeof t?JSON.parse(t):t,i="",a="S.No,";for(let c in r)a+=r[c]+",";a=a.slice(0,-1),i+=a+"\r\n";for(let c=0;c<o.length;c++){let d=c+1+"";for(let m in r)d+=","+o[c][r[m]];i+=d+"\r\n"}return i}uploadAll(){return this.ht.get("../../../assets/csvjson.json").pipe((0,M.b)(console.log),(0,z.u)(),(0,$.j)(50),(0,T.U)(t=>{var r=this.db.firestore.batch();return t.map(o=>{const{id:i,...a}=o;return r.set(this.db.collection(this.dbPath).doc(i).ref,a),r.set(this.db.collection("/FPreport").doc(i).ref,{name:a.name,available:0,commited:0,wating:0,timestamp:R.EK.fromDate(new Date)})}),r.commit()}),(0,M.b)({complete:()=>alert("completo"),error:()=>alert("error")}))}deleteAll(){return this.productsRef.get().pipe((0,T.U)(t=>t.docs),(0,M.b)(t=>this.downloadFile(t.map(r=>r.data()))),(0,z.u)(),(0,$.j)(500),(0,C.z)(t=>{var r=this.db.firestore.batch();return t.map(o=>r.delete(o.ref)),r.commit()}))}}return s.\u0275fac=function(t){return new(t||s)(e.LFG(oe.ST),e.LFG(ge))},s.\u0275prov=e.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})();var ee=l(2121),F=l(7915),u=l(4006),J=l(5748);function be(s,n){1&s&&(e.TgZ(0,"h6"),e._uU(1," El proceso puede ser tardado por favor espere."),e.qZA())}function Oe(s,n){1&s&&(e.TgZ(0,"div"),e._UZ(1,"br"),e.TgZ(2,"p"),e._uU(3,"Seleccione una orden..."),e.qZA()())}function Ce(s,n){if(1&s){const t=e.EpF();e.TgZ(0,"li",32)(1,"div",33)(2,"div",34),e._uU(3),e.qZA(),e.TgZ(4,"div",35)(5,"input",36),e.NdJ("ngModelChange",function(o){const a=e.CHM(t).$implicit;return e.KtG(a.quantity=o)}),e.qZA(),e.TgZ(6,"span",37),e._uU(7,"U"),e.qZA()()()()}if(2&s){const t=n.$implicit;e.xp6(3),e.hij(" ",t.name," "),e.xp6(2),e.Q6J("ngModel",t.quantity)}}const Te=function(){return["btn-outline-success"]},xe=function(){return["btn-outline-primary"]};function Me(s,n){if(1&s){const t=e.EpF();e.TgZ(0,"div",26)(1,"h4"),e._uU(2,"Orden"),e.qZA(),e.TgZ(3,"app-form",27),e.NdJ("formModel",function(o){e.CHM(t);const i=e.oxw();return e.KtG(i.submit(o))}),e.qZA(),e.TgZ(4,"p"),e._uU(5,"productos de la Orden: "),e.qZA(),e.TgZ(6,"ul",28),e.YNc(7,Ce,8,2,"li",29),e.qZA(),e.TgZ(8,"app-warn-modal",30),e.NdJ("continue",function(o){e.CHM(t);const i=e.oxw();return e.KtG(i.setOrderReady(o))}),e.qZA(),e.TgZ(9,"app-warn-modal",31),e.NdJ("continue",function(o){e.CHM(t);const i=e.oxw();return e.KtG(i.completeOrder(o))}),e.qZA()()}if(2&s){const t=e.oxw();e.xp6(3),e.Q6J("mode",!0)("formObj",t.formObj)("placeHolder",t.currentOrder),e.xp6(4),e.Q6J("ngForOf",t.currentOrder.orderProducts),e.xp6(1),e.Q6J("classlist",e.DdM(6,Te)),e.xp6(1),e.Q6J("classlist",e.DdM(7,xe))}}const Pe=function(){return["btn-outline-danger","float-end"]};let Ee=(()=>{class s{constructor(t,r,o,i){this.OrderService=t,this.invFpService=r,this.invRmService=o,this.fo=i,this.title="",this.currentIndex=-1,this.q="",this.queryChange=void 0,this.codeFilter=!1,this.download=!1,this.formObj=[[new p.O("Numero de Orden de Pedido","name","text"),new p.O("Estado","state","text")],[new p.O("Nombre del Cliente","clientName","text")],[new p.O("Fecha de Embarque","shipDate","date")],[new p.O("Dias de Produccion","productionDays","number"),new p.O("Pedido de Insumos","orderInput","number")],[new p.O("Pedido Materia Prima","rmOrderDeadline","date"),new p.O("Limite inicio de Produccion","startProductionDeadline","date")],[new p.O("Notas","notes","text")]]}ngOnInit(){}submit(t){}getSelectedElement(t){this.currentOrder=t.element,this.currentIndex=t.index}filter(){this.queryChange={value:this.orderStateFilter,exact:!0},this.currentOrder=void 0}refreshList(){this.orderStateFilter=void 0,this.currentOrder=void 0}ngOnChanges(t){t.orderStateFilter&&(this.currentOrder=void 0)}editProducts(){}downloadFinishedOrders(t){!t||(this.download=!0,this.fo.deleteAll().subscribe({complete:()=>{this.download=!1,alert("Ordenes Terminadas Eliminadas correctamente")},error:()=>{this.download=!1,alert("Error inesperado, porfavor intente de nuevo")}}))}setOrderReady(t){if(t){if("ESPERANDO MATERIAL"==this.currentOrder?.state)return void alert('La orden NO puede establecerse como "LISTA" ya que est\xe1 "ESPERANDO MATERIAL".');(0,L.z)((0,v.D)(this.currentOrder?.orderProducts??[]).pipe((0,C.z)(r=>(0,v.D)(this.invFpService.getStock(r.invId)).pipe((0,q.q)(1),(0,S.w)(o=>this.invFpService.update(r.invId,{wating:Math.max(0,+(o.wating??0)-r.quantity),commited:Math.max(0,+(o.commited??0)+r.quantity)}))))),this.OrderService.update(this.currentOrder?.id,{state:"TERMINADA"})).subscribe({error:r=>alert(r),complete:()=>alert("La orden fue establecida como terminada satisfactoriamente")})}}completeOrder(t){if(t){if("EN PRODUCCION"==this.currentOrder?.state)return void alert('La orden NO puede establecerse como "TERMINADA" ya que est\xe1 "EN PRODUCCION".');var r=(0,v.D)(this.currentOrder?.orderProducts??[]).pipe((0,C.z)(i=>(0,v.D)(this.invFpService.getStock(i.invId)).pipe((0,q.q)(1),(0,S.w)(a=>this.invFpService.update(i.invId,{commited:Math.max(0,+(a.commited??0)-i.quantity)}))))),o=(0,v.D)(this.currentOrder?.orderMaterials??[]).pipe((0,C.z)(i=>this.invRmService.getStock(i.matId).pipe((0,q.q)(1),(0,S.w)(a=>this.invRmService.update(a.id,{commited:Math.max(0,+(a.commited??0)-+i.quantity)})))));(0,L.z)((0,N.T)(r,o),(0,N.T)(this.OrderService.delete(this.currentOrder?.id),this.fo.create({state:"ENTREGADA",...this.currentOrder}))).pipe((0,M.b)({complete:()=>alert("Orden Completada")})).subscribe(),this.refreshList()}}readableDate(t){var r=new Date(t);return r.getDate()+"/"+r.getMonth()+"/"+r.getFullYear()}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(j.p),e.Y36(Z.L),e.Y36(X.y),e.Y36(ye))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-orders-list"]],features:[e.TTD],decls:37,vars:10,consts:[[1,"container","mt-5","vh-100"],["role","search",1,"d-flex","form-inline"],[1,"text-muted","text-nowrap","my-auto"],[1,"form-floating","flex-fill","ms-5","me-2"],["name","state","id","floatingSelect","aria-label","providers select",1,"form-select",3,"ngModel","ngModelChange"],[3,"ngValue"],["ngValue","ESPERANDO MATERIAL"],["ngValue","EN PRODUCCION"],["ngValue","TERMINADA"],["ngValue","ENTREGADA"],["for","floatingSelect"],["type","submit",1,"btn","btn-outline-success","float-end",3,"click"],["type","button","btnMessage","Descargar Ordenes Terminadas","modalMessage","Esta seguro de que desea descargar todas las ordenes terminadas?",3,"classlist","continue"],[4,"ngIf"],[1,"position-fixed","bottom-0","end-0",2,"margin","6rem","z-index","1070"],["routerLink","add",1,"btn","btn-success","btn-lg","rounded-pill"],["fill","#ffffff","version","1.1","id","Capa_1","xmlns","http://www.w3.org/2000/svg",0,"xmlns","xlink","http://www.w3.org/1999/xlink","width","4vh","height","4vh","viewBox","0 0 47 47",0,"xml","space","preserve","stroke","#ffffff"],["id","SVGRepo_bgCarrier","stroke-width","0"],["id","SVGRepo_tracerCarrier","stroke-linecap","round","stroke-linejoin","round"],["id","SVGRepo_iconCarrier"],["d","M41.267,18.557H26.832V4.134C26.832,1.851,24.99,0,22.707,0c-2.283,0-4.124,1.851-4.124,4.135v14.432H4.141 c-2.283,0-4.139,1.851-4.138,4.135c-0.001,1.141,0.46,2.187,1.207,2.934c0.748,0.749,1.78,1.222,2.92,1.222h14.453V41.27 c0,1.142,0.453,2.176,1.201,2.922c0.748,0.748,1.777,1.211,2.919,1.211c2.282,0,4.129-1.851,4.129-4.133V26.857h14.435 c2.283,0,4.134-1.867,4.133-4.15C45.399,20.425,43.548,18.557,41.267,18.557z"],[1,"list","row","shadow-sm"],[1,"col-md-6"],[3,"path","key","query","selectedElement"],[1,"col-lg-6"],["class","edit-form",4,"ngIf"],[1,"edit-form"],["btnMes","Crear Orden","modalMessage","\xbfDesea continuar con la creacion de la Orden?",3,"mode","formObj","placeHolder","formModel"],[1,"list-group","mt-1","mb-3"],["class","list-group-item",4,"ngFor","ngForOf"],["type","submit","btnMessage","Orden Lista","modalMessage","\xbfSeguro que desea marcar la orden como lista?",3,"classlist","continue"],["type","submit","btnMessage","Completar Orden","modalMessage","\xbfSeguro que desea completar la orden?",3,"classlist","continue"],[1,"list-group-item"],[1,"d-flex","flex-row","mx-auto"],[1,"my-auto","text-nowrap"],[1,"input-group","h-25","my-auto","ms-2"],["type","number","placeholder","Unidades","readonly","","name","UP","readonly","","aria-label","quantity",1,"form-control","input-sm",3,"ngModel","ngModelChange"],[1,"input-group-text"]],template:function(t,r){1&t&&(e.TgZ(0,"div",0)(1,"form",1)(2,"h4",2),e._uU(3,"Lista de Ordenes"),e.qZA(),e.TgZ(4,"div",3)(5,"select",4),e.NdJ("ngModelChange",function(i){return r.orderStateFilter=i}),e.TgZ(6,"option",5),e._uU(7,"TODAS"),e.qZA(),e.TgZ(8,"option",6),e._uU(9,"ESPERANDO MATERIAL"),e.qZA(),e.TgZ(10,"option",7),e._uU(11,"EN PRODUCCION"),e.qZA(),e.TgZ(12,"option",8),e._uU(13,"TERMINADA"),e.qZA(),e.TgZ(14,"option",9),e._uU(15,"ENTREGADA"),e.qZA()(),e.TgZ(16,"label",10),e._uU(17,"Buscar por Estado"),e.qZA()(),e.TgZ(18,"button",11),e.NdJ("click",function(){return r.filter()}),e._uU(19,"Buscar"),e.qZA(),e.TgZ(20,"app-warn-modal",12),e.NdJ("continue",function(i){return r.downloadFinishedOrders(i)}),e.qZA()(),e._UZ(21,"hr"),e.YNc(22,be,2,0,"h6",13),e.TgZ(23,"div",14)(24,"button",15),e.O4$(),e.TgZ(25,"svg",16),e._UZ(26,"g",17)(27,"g",18),e.TgZ(28,"g",19)(29,"g"),e._UZ(30,"path",20),e.qZA()()()()(),e.kcU(),e.TgZ(31,"div",21)(32,"div",22)(33,"app-pagination",23),e.NdJ("selectedElement",function(i){return r.getSelectedElement(i)}),e.qZA()(),e.TgZ(34,"div",24),e.YNc(35,Oe,4,0,"div",13),e.YNc(36,Me,10,8,"div",25),e.qZA()()()),2&t&&(e.xp6(5),e.Q6J("ngModel",r.orderStateFilter),e.xp6(1),e.Q6J("ngValue",void 0),e.xp6(14),e.Q6J("classlist",e.DdM(9,Pe)),e.xp6(2),e.Q6J("ngIf",r.download),e.xp6(11),e.Q6J("path","/orders")("key","state")("query",r.queryChange),e.xp6(2),e.Q6J("ngIf",!r.currentOrder),e.xp6(1),e.Q6J("ngIf",r.currentOrder))},dependencies:[f.sg,f.O5,O.rH,ee.u,F.U,u._Y,u.YN,u.Kr,u.Fj,u.wV,u.EJ,u.JJ,u.JL,u.On,u.F,J.Q]}),s})();var k=l(5861);class _e{}var we=l(3602);class qe{}var H=l(4128),Se=l(5561),Ne=l(798),te=l(3651);let U=(()=>{class s{constructor(t,r,o,i,a,c,d){this.invFP=t,this.invrmService=r,this.orderService=o,this.router=i,this.shopService=a,this.auditService=c,this.auth=d,this.reqMaterials=[],this.materials=[],this.orderProducts=[],this.order=new qe}updateProviderMaterialStock(){return this.materials?(0,H.D)(Array.from(Object.entries(this.materials)).map(t=>this.invrmService.getStock(t[0]).pipe((0,T.U)(r=>{if(null==r.available||null==r.commited||null==r.wating||null==r.watingCommited)return{};var o=Math.max(0,t[1].quantity-r.available),i=o>0,a={commited:+r.commited+Math.min(r.available,t[1].quantity),available:Math.max(0,+r.available-t[1].quantity),watingCommited:+r.watingCommited+Math.max(0,t[1].quantity-r.available)};return{matId:t[0],name:t[1].name,quantity:t[1].quantity,id:r.id,oldStock:r,newStock:a,requestMaterial:i,requested:o}})))):(0,G.of)([])}initMaterialOrder(){this.reqMaterials.forEach(t=>{var r=t.requested<t.minBatch?t.minBatch-t.requested:0;t.newStock.wating+=+r,t.amount=r})}assignProvider(t,r){this.reqMaterials[t].minBatch=r.minBatch,this.reqMaterials[t].deliveryTime=r.deliveryTime,this.reqMaterials[t].price=r.price,alert("Provedor asignado satisfactoriamente")}getOrderWaitMaxTime(){return Math.max(...this.reqMaterials.map(t=>t.deliveryTime))}getTotalPrice(){console.log("AAAA");var t=this.orderProducts.reduce((r,o)=>("mxn"==o.currency?r.mxn=r.mxn?r.mxn+o.price*o.quantity:o.price*o.quantity:r.usd=r.usd?r.usd+o.price*o.quantity:o.price*o.quantity,r),[]);this.order.total=t}getTotalMaterials(){this.orderProducts?(this.orderProducts.forEach(t=>t.materials.forEach(r=>r.quantity*=t.quantity)),this.materials=this.orderProducts.flatMap(t=>t.materials).reduce((t,r)=>(t[r.id]=t[r.id]?{name:r.name,quantity:t[r.id].quantity+r.quantity}:{name:r.name,quantity:r.quantity},t),{})):this.materials=[]}useFP(t,r){var o=this;return(0,k.Z)(function*(){if(o.orderProducts[r].stock)o.orderProducts[r].available=o.orderProducts[r].available?void 0:o.orderProducts[r].stock.available;else{var i=(yield o.invFP.getStock(t))||0;o.orderProducts[r].available=i.available,o.orderProducts[r].stock=i}})()}updateOrderProductStock(){var t=this;this.orderProducts.forEach(function(){var r=(0,k.Z)(function*(o){var i;o.useFP?i={available:Math.max(0,o.stock.available-o.quantity),commited:+o.stock.commited+Math.min(o.quantity,o.stock.available),wating:+o.stock.wating+Math.max(0,o.quantity-o.stock.available)}:(o.stock||(o.stock=(yield t.invFP.getStock(o.id))||0),i={wating:+o.stock.wating+ +o.quantity}),o.newStock=i});return function(o){return r.apply(this,arguments)}}())}updateProductStock(){return(0,v.D)(this.orderProducts).pipe((0,C.z)(t=>(0,H.D)([this.invFP.update(t.stock.id,t.newStock),this.makeProdStockReport(t.id,t.name,t.stock,t.newStock)])))}updateMaterialStock(t,r){console.log(t);var o=(0,v.D)(this.reqMaterials).pipe((0,C.z)(a=>(0,H.D)([this.shopService.create(a.matId,a.name,a.requested+a.amount,a.amount,R.EK.fromDate(new Date(this.order?.rmOrderDeadline)),a.id,(a.requested+a.amount)*a.price,t),this.invrmService.update(a.id,a.newStock),this.makeMatStockReport(a.matId,a.name,a.oldStock,a.newStock)]))),i=(0,v.D)(this.materials).pipe((0,C.z)(a=>(0,H.D)([this.invrmService.update(a.id,a.newStock),this.makeMatStockReport(a.matId,a.name,a.oldStock,a.newStock)])));return(0,N.T)(o,i)}makeProdStockReport(t,r,o,i){return this.auditService.create(_e.name,`Actualizacion Stock de Producto: ${r}`,this.auth.username,JSON.stringify(i),JSON.stringify(o),t)}makeMatStockReport(t,r,o,i){return this.auditService.create(we.N.name,`Actualizacion Stock de Material: ${r}`,this.auth.username,JSON.stringify(i),JSON.stringify(o),t)}editProducts(){var t=this.orderProducts.map(o=>({id:o.id,invId:o.invId,name:o.name,quantity:o.quantity}));return this.orderService.create({orderProducts:t,state:0==this.reqMaterials.length?"EN PRODUCCION":"ESPERANDO MATERIAL",orderMaterials:this.materials.concat(this.reqMaterials).map(o=>({matId:o.matId,quantity:o.quantity})),timestamp:R.EK.fromDate(new Date),...this.order}).pipe((0,q.q)(1),(0,S.w)(o=>(0,N.T)(this.updateMaterialStock(o.id,o.name??""),this.updateProductStock())),(0,M.b)({error:o=>{console.log(o),alert("Ha ocurrido un error intente de nuevo.")},complete:()=>{alert("Orden Creada correctamente"),console.log("ENDED")}}))}}return s.\u0275fac=function(t){return new(t||s)(e.LFG(Z.L),e.LFG(X.y),e.LFG(j.p),e.LFG(O.F0),e.LFG(Se.l),e.LFG(Ne.C),e.LFG(te.e))},s.\u0275prov=e.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})();function Ae(s,n){if(1&s){const t=e.EpF();e.TgZ(0,"li",13)(1,"div",14)(2,"span",15),e._uU(3),e.qZA(),e.TgZ(4,"div",16)(5,"input",17),e.NdJ("ngModelChange",function(o){const a=e.CHM(t).$implicit;return e.KtG(a.quantity=o)}),e.qZA(),e.TgZ(6,"span",18),e._uU(7,"U"),e.qZA(),e.TgZ(8,"input",19),e.NdJ("ngModelChange",function(o){const a=e.CHM(t).$implicit;return e.KtG(a.available=o)}),e.qZA(),e.TgZ(9,"span",18),e._uU(10,"U"),e.qZA(),e.TgZ(11,"div",20)(12,"label",21),e._uU(13," Usar PT"),e.qZA(),e.TgZ(14,"input",22),e.NdJ("change",function(){const o=e.CHM(t),i=o.$implicit,a=o.index,c=e.oxw();return e.KtG(c.orderBuisness.useFP(i.invId,a))}),e.qZA()()(),e.TgZ(15,"button",23),e.NdJ("click",function(){const i=e.CHM(t).index,a=e.oxw();return e.KtG(a.removeProductFromOrder(i))}),e.qZA()()()}if(2&s){const t=n.$implicit;e.xp6(3),e.hij(" ",t.name," "),e.xp6(2),e.Q6J("ngModel",t.quantity),e.xp6(3),e.Q6J("ngModel",t.available),e.xp6(6),e.Q6J("ngModel",t.useFP)}}let ke=(()=>{class s{constructor(t,r,o){this.router=t,this.invFP=r,this.orderBuisness=o,this.orderProducts=[],this.materials=[],this.q="",this.query="",this.codeFilter=!1,this.continueDisabled=!0}ngOnInit(){}filter(){this.q=this.query}createOrder(){0==this.orderBuisness.orderProducts.filter(t=>!t.quantity||t.quantity<0||!Number.isInteger(t.quantity)).length?(console.log(this.orderBuisness.orderProducts),this.orderBuisness.getTotalMaterials(),this.orderBuisness.updateOrderProductStock(),this.orderBuisness.getTotalPrice(),this.orderBuisness.orderProducts.forEach(t=>{delete t.materials,delete t.available}),this.router.navigate(["orders/add/providers"])):alert("Hay productos sin cantidad asignada o menor a 0, porfavor rectifique.")}useFP(t,r){var o=this;return(0,k.Z)(function*(){if(o.orderProducts[r].stock)o.orderProducts[r].available=o.orderProducts[r].available?void 0:o.orderProducts[r].stock.available;else{var i=(yield o.invFP.getStock(t))||0;o.orderProducts[r].available=i.available,o.orderProducts[r].stock=i}})()}addProductToOrder(t){this.continueDisabled=!1,this.orderBuisness.orderProducts.find(o=>o.id==t.id)||this.orderBuisness.orderProducts.push({name:t.name,id:t.id,invId:t.invId,leadTime:t.leadTime,materials:t.materials,price:t.price,currency:t.currency})}validate(){}removeProductFromOrder(t){this.orderBuisness.orderProducts.splice(t,1),this.continueDisabled=!!this.orderBuisness.orderProducts.length}getSelectedElement(t){this.continueDisabled=!!this.orderBuisness.orderProducts.length,this.addProductToOrder(t.element)}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(O.F0),e.Y36(Z.L),e.Y36(U))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-order-products"]],decls:21,vars:4,consts:[[1,"container","mt-5","vh-100"],["role","search",1,"d-flex"],[1,"text-muted","text-nowrap","my-auto"],["type","search","name","query","placeholder","Buscar por Nombre","aria-label","Search",1,"form-control","ms-2","me-2","float-end",3,"ngModel","ngModelChange"],["type","submit",1,"btn","btn-outline-success","float-end",3,"click"],[1,"list","row","shadow-sm"],[1,"col-md-6"],[1,"text-muted","mt-1"],[3,"path","query","selectedElement"],[1,"edit-form"],[1,"mt-4","rounded-pill","btn","btn-outline-success",3,"click"],[1,"list-group","mt-3","mb-3"],["class","list-group-item",4,"ngFor","ngForOf"],[1,"list-group-item"],[1,"d-flex","flex-row","justify-content-between"],[1,"my-auto"],[1,"input-group"],["type","number","placeholder","Unidades","name","UP","min","1","step","1","oninput","validity.valid||(value='') || Number.isInteger(value);","aria-label","quantity",1,"form-control","input-sm",3,"ngModel","ngModelChange"],[1,"input-group-text"],["type","number","readonly","","placeholder","Disponible en PT","name","stock","aria-label","stock",1,"form-control","input-sm",3,"ngModel","ngModelChange"],[1,"form-check","input-group-append","mx-2","my-auto"],["for","flexCheckDefault",1,"form-check-label"],["type","checkbox","id","flexCheckDefault","name","codeFilter",1,"form-check-input",3,"ngModel","change"],[1,"btn-close","my-auto","btn-sm","rounded-pill","float-end",3,"click"]],template:function(t,r){1&t&&(e.TgZ(0,"div",0)(1,"form",1)(2,"h3",2),e._uU(3,"Registrar orden"),e.qZA(),e.TgZ(4,"input",3),e.NdJ("ngModelChange",function(i){return r.query=i}),e.qZA(),e.TgZ(5,"button",4),e.NdJ("click",function(){return r.filter()}),e._uU(6,"Buscar"),e.qZA()(),e._UZ(7,"hr"),e.TgZ(8,"div",5)(9,"div",6)(10,"h5",7),e._uU(11,"Productos disponibles:"),e.qZA(),e.TgZ(12,"app-pagination",8),e.NdJ("selectedElement",function(i){return r.getSelectedElement(i)}),e.qZA()(),e.TgZ(13,"div",6)(14,"div",9)(15,"button",10),e.NdJ("click",function(){return r.createOrder()}),e._uU(16,"Continuar"),e.qZA(),e.TgZ(17,"p"),e._uU(18,"productos de la Orden: "),e.qZA(),e.TgZ(19,"ul",11),e.YNc(20,Ae,16,4,"li",12),e.qZA()()()()()),2&t&&(e.xp6(4),e.Q6J("ngModel",r.query),e.xp6(8),e.Q6J("path","/products")("query",r.q),e.xp6(8),e.Q6J("ngForOf",r.orderBuisness.orderProducts))},dependencies:[f.sg,u._Y,u.Fj,u.wV,u.Wl,u.JJ,u.JL,u.qQ,u.On,u.F,J.Q]}),s})();var He=l(1135),re=l(727);function Ze(s,n){if(1&s){const t=e.EpF();e.TgZ(0,"li",15)(1,"div",16)(2,"span",17),e._uU(3),e.qZA(),e.TgZ(4,"div",18)(5,"input",19),e.NdJ("ngModelChange",function(o){const a=e.CHM(t).$implicit;return e.KtG(a.quantity=o)}),e.qZA(),e.TgZ(6,"span",20),e._uU(7,"U"),e.qZA(),e.TgZ(8,"input",21),e.NdJ("ngModelChange",function(o){const a=e.CHM(t).$implicit;return e.KtG(a.stock=o)}),e.qZA(),e.TgZ(9,"span",20),e._uU(10,"U"),e.qZA(),e.TgZ(11,"div",22)(12,"label",23),e._uU(13," Usar PT"),e.qZA(),e._UZ(14,"input",24),e.qZA()()()()}if(2&s){const t=n.$implicit;e.xp6(3),e.hij(" ",t.name," "),e.xp6(2),e.Q6J("ngModel",t.quantity),e.xp6(3),e.Q6J("ngModel",t.stock),e.xp6(6),e.Q6J("ngModel",t.useFP)}}function Re(s,n){1&s&&(e.TgZ(0,"div"),e._UZ(1,"br"),e.TgZ(2,"p"),e._uU(3,"No se selecciono ningun producto..."),e.qZA()())}let Ie=(()=>{class s{constructor(t,r,o){this.router=t,this.auth=r,this.orderBusiness=o,this.submitted=!1,this.q="",this.queryChange=void 0,this.orderProducts=[],this.reqMaterials=[],this.materials=[],this.clientName="",this.clientName$=new He.X(this.clientName),this.create$=new re.w0,this.getClientName=()=>this.clientName,this.getProductionDays=()=>Math.ceil(this.orderBusiness.orderProducts.map(i=>i.leadTime*i.quantity).reduce((i,a)=>i+a,0)),this.getOrderInput=()=>this.order.orderWaitMaxTime,this.getRmOrderDeadline=(i,a,c)=>{if(!(i&&a&&c))return;const d=new Date(i);return d.setDate(new Date(i).getDate()-c-a),d.toLocaleDateString()},this.getStartProductionDeadline=(i,a,c)=>{if(!(i&&a&&c))return;const d=new Date(i);return d.setDate(new Date(i).getDate()-a),d.toLocaleDateString()},console.log(this.orderBusiness.order),0==Object.keys(this.orderBusiness.order).length&&this.router.navigate(["/orders/add"]),this.order=this.orderBusiness.order,console.log(this.order,this.orderBusiness.order),this.formObj=[[new p.O("Numero de Orden de Pedido","name","text")],[new p.O("Nombre del Client","clientName","text")],[new p.O("Fecha de Embarque","shipDate","date")],[new p.O("Dias de Produccion","productionDays","number"),new p.O("Pedido de Insumos","orderInput","number")],[new p.O("Pedido Materia Prima","rmOrderDeadline","date",[this.custom]),new p.O("Limite inicio de Produccion","startProductionDeadline","date")]]}ngAfterViewInit(){this.clientName$.subscribe(o=>this.formC.f.clientName.patchValue(o));var t=this.getProductionDays();this.formC.f.productionDays.patchValue(t),this.formC.f.productionDays.markAsTouched(),this.formC.f.orderInput.patchValue(this.order.orderWaitMaxTime),this.formC.f.orderInput.markAsTouched(),this.formC.f.shipDate.valueChanges.pipe((0,M.b)(o=>{this.formC.f.rmOrderDeadline.patchValue(this.getRmOrderDeadline(o,t,this.order.orderWaitMaxTime)),this.formC.f.rmOrderDeadline.markAsTouched(),this.formC.f.startProductionDeadline.patchValue(this.getStartProductionDeadline(o,t,this.order.orderWaitMaxTime)),this.formC.f.startProductionDeadline.markAsTouched()})).subscribe()}ngOnInit(){}filterProducts(){this.queryChange=this.q}getSelectedElement(t){this.order&&(this.clientName=t.element.name,this.clientName$.next(this.clientName),this.orderBusiness.order.clientId=t.element.id)}custom(t){return new Date(t.value)>new Date||null==t.value?null:{custom:"La fecha de Limite del Pedido de material debe ser almenos 2 dias despu\xe9s del dia actual"}}submit(t){this.orderBusiness.order=t,console.log(this.orderBusiness.order),this.create$=this.orderBusiness.editProducts().subscribe()}ngOnDestroy(){this.create$.unsubscribe()}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(O.F0),e.Y36(te.e),e.Y36(U))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-add-order"]],viewQuery:function(t,r){if(1&t&&e.Gf(F.U,5),2&t){let o;e.iGM(o=e.CRH())&&(r.formC=o.first)}},decls:30,vars:14,consts:[[1,"container","mt-5","vh-100"],["role","search",1,"d-flex"],[1,"text-muted","text-nowrap","my-auto"],["type","search","name","query","placeholder","Buscar por Nombre","aria-label","Search",1,"form-control","ms-2","me-2","float-end",3,"ngModel","ngModelChange"],["type","submit",1,"btn","btn-outline-success","float-end",3,"click"],[1,"list","row","shadow-sm"],[1,"col-md-6"],[1,"text-muted","mt-1"],[3,"path","query","selectedElement"],["btnMes","Crear Orden","modalMessage","\xbfDesea continuar con la creacion de la Orden?",3,"formObj","formModel"],[1,"text-muted"],[1,"bold"],[1,"list-group","mt-3","mb-3"],["class","list-group-item",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"list-group-item"],[1,"d-flex","flex-row","justify-content-between"],[1,"my-auto"],[1,"input-group"],["type","number","placeholder","Unidades","name","UP","readonly","","aria-label","quantity",1,"form-control","input-sm",3,"ngModel","ngModelChange"],[1,"input-group-text"],["type","number","readonly","","placeholder","Disponible en PT","name","stock","aria-label","stock",1,"form-control","input-sm",3,"ngModel","ngModelChange"],[1,"form-check","input-group-append","mx-2","my-auto"],["for","flexCheckDefault",1,"form-check-label"],["readonly","","type","checkbox","id","flexCheckDefault","name","codeFilter",1,"form-check-input",3,"ngModel"]],template:function(t,r){1&t&&(e.TgZ(0,"div",0)(1,"form",1)(2,"h3",2),e._uU(3,"Registrar orden"),e.qZA(),e.TgZ(4,"input",3),e.NdJ("ngModelChange",function(i){return r.q=i}),e.qZA(),e.TgZ(5,"button",4),e.NdJ("click",function(){return r.filterProducts()}),e._uU(6,"Buscar"),e.qZA()(),e._UZ(7,"hr"),e.TgZ(8,"div",5)(9,"div",6)(10,"h5",7),e._uU(11,"Lista de Clientes:"),e.qZA(),e.TgZ(12,"app-pagination",8),e.NdJ("selectedElement",function(i){return r.getSelectedElement(i)}),e.qZA()(),e.TgZ(13,"div",6)(14,"h4"),e._uU(15,"Nueva Orden"),e.qZA(),e.TgZ(16,"app-form",9),e.NdJ("formModel",function(i){return r.submit(i)}),e.qZA(),e.TgZ(17,"h4",10),e._uU(18,"Total: "),e.qZA(),e.TgZ(19,"h5",11),e._uU(20),e.ALo(21,"currency"),e.qZA(),e.TgZ(22,"h5",11),e._uU(23),e.ALo(24,"currency"),e.qZA(),e.TgZ(25,"p"),e._uU(26,"productos de la Orden: "),e.qZA(),e.TgZ(27,"ul",12),e.YNc(28,Ze,15,4,"li",13),e.qZA()(),e.YNc(29,Re,4,0,"div",14),e.qZA()()),2&t&&(e.xp6(4),e.Q6J("ngModel",r.q),e.xp6(8),e.Q6J("path","/clients")("query",r.queryChange),e.xp6(4),e.Q6J("formObj",r.formObj),e.xp6(4),e.Oqu(e.xi3(21,8,r.order.total.mxn,"MXN")),e.xp6(3),e.hij(" ",e.xi3(24,11,r.order.total.usd,"USD"),""),e.xp6(5),e.Q6J("ngForOf",r.orderBusiness.orderProducts),e.xp6(1),e.Q6J("ngIf",!r.orderProducts))},dependencies:[f.sg,f.O5,F.U,u._Y,u.Fj,u.wV,u.Wl,u.JJ,u.JL,u.On,u.F,J.Q,f.H9]}),s})();var De=l(5872);function Fe(s,n){1&s&&(e.TgZ(0,"span"),e.O4$(),e.TgZ(1,"svg",12),e._UZ(2,"path",13),e.qZA()())}function Je(s,n){if(1&s){const t=e.EpF();e.TgZ(0,"li",11),e.NdJ("click",function(){const o=e.CHM(t),i=o.$implicit,a=o.index,c=e.oxw();return e.KtG(c.setActiveMaterial(i,a))}),e._uU(1),e.YNc(2,Fe,3,0,"span",10),e.qZA()}if(2&s){const t=n.$implicit,r=n.index,o=e.oxw();e.ekj("active",r==o.currentIndex),e.xp6(1),e.hij(" ",t.name," "),e.xp6(1),e.Q6J("ngIf",t.minBatch)}}function Ue(s,n){if(1&s&&(e.TgZ(0,"option",19),e._uU(1),e.qZA()),2&s){const t=n.$implicit;e.Q6J("ngValue",t),e.xp6(1),e.Oqu(t.name)}}function Be(s,n){if(1&s){const t=e.EpF();e.TgZ(0,"div",14)(1,"select",15),e.NdJ("ngModelChange",function(o){e.CHM(t);const i=e.oxw();return e.KtG(i.currentProvider=o)}),e.TgZ(2,"option",16),e._uU(3,"Seleccione Proveedor"),e.qZA(),e.YNc(4,Ue,2,2,"option",17),e.qZA(),e.TgZ(5,"label",18),e._uU(6,"Proveedores"),e.qZA()()}if(2&s){const t=e.oxw();e.xp6(1),e.Q6J("ngModel",t.currentProvider),e.xp6(1),e.Q6J("ngValue",void 0),e.xp6(2),e.Q6J("ngForOf",t.providers)}}function Le(s,n){if(1&s){const t=e.EpF();e.TgZ(0,"button",20),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.assignProvider())}),e._uU(1," Asignar Provedores"),e.qZA()}}function je(s,n){1&s&&(e.TgZ(0,"div"),e._UZ(1,"br"),e.TgZ(2,"p"),e._uU(3,"No se selecciono ningun producto..."),e.qZA()())}const Xe=[{path:"",component:Ee},{path:"add",component:ke},{path:"add/create",component:Ie},{path:"add/providers",component:(()=>{class s{constructor(t,r,o){this.orderBusiness=t,this.provService=r,this.router=o,this.stock$=new re.w0,this.materials=[],this.reqMaterials=[],this.providers=[],this.orderProducts=[],this.q="",this.query="",this.formObj=[[new p.O("Nombre","name","text"),new p.O("Lote Minimo","minBatch","number")],[new p.O("Descripcion","description","text")],[new p.O("Precio","price","number")],[new p.O("Cantidad en Inventario","available","number")],[new p.O("Tiempo de Entrega","deliveryTime","number")],[new p.O("Area","area","text"),new p.O("Zona","zone","text"),new p.O("Posicion","position","text")]]}ngOnInit(){(0==this.orderBusiness.materials.length||0==this.orderBusiness.orderProducts.length)&&this.router.navigate(["/orders/add"]),this.stock$=this.orderBusiness.updateProviderMaterialStock().subscribe(t=>{this.reqMaterials=t.filter(r=>r.requestMaterial),this.materials=t.filter(r=>!r.requestMaterial)})}ngOnDestroy(){this.stock$.unsubscribe()}initMaterialOrder(){this.reqMaterials.forEach(t=>{var r=t.requested<t.minBatch?t.minBatch-t.requested:0;t.newStock.wating+=r,t.amount=r})}filter(){this.q=this.query}setActiveMaterial(t,r){var o=this;return(0,k.Z)(function*(){o.providers=[],o.currentProvider=void 0,o.currentMaterial=t,o.currentIndex=r,o.providers=yield o.provService.getProvidersByMaterial(o.currentMaterial.matId)})()}assignProvider(){this.reqMaterials[this.currentIndex].minBatch=this.currentProvider.minBatch,this.reqMaterials[this.currentIndex].deliveryTime=this.currentProvider.deliveryTime,this.reqMaterials[this.currentIndex].price=this.currentProvider.price,alert("Provedor asignado satisfactoriamente")}getOrderWaitMaxTime(){return Math.max(...this.reqMaterials.map(t=>t.deliveryTime))}getSelectedElement(t){this.currentMaterial=t.element}submit(t){0==this.reqMaterials.filter(o=>!o.hasOwnProperty("minBatch")).length?(this.initMaterialOrder(),this.orderBusiness.order.orderWaitMaxTime=this.getOrderWaitMaxTime(),this.orderBusiness.order.orderProducts=this.orderProducts,this.orderBusiness.materials=this.materials,this.orderBusiness.reqMaterials=this.reqMaterials,this.router.navigate(["orders/add/create"])):alert("Aun hay materiales sin proveedor asignador, porfavor rectifique.")}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(U),e.Y36(De.H),e.Y36(O.F0))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-order-providers"]],decls:17,vars:5,consts:[[1,"container","mt-5","vh-100"],[1,"text-muted","text-nowrap","my-auto"],[1,"list","row","shadow-sm"],[1,"col-md-6"],[1,"text-muted","mt-1"],[1,"list-group","mt-3","mb-3"],["class","list-group-item d-flex justify-content-between align-items-center",3,"active","click",4,"ngFor","ngForOf"],["class","form-floating",4,"ngIf"],["class","btn-outline-primary btn rounded-pill",3,"click",4,"ngIf"],["type","submit","modalMessage","\xbfSeguro que desea continuar a crear una nueva orden?",3,"btnMessage","continue"],[4,"ngIf"],[1,"list-group-item","d-flex","justify-content-between","align-items-center",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","25","height","25","fill","green","viewBox","0 0 16 16",1,"bi","bi-check"],["d","M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.267.267 0 0 1 .02-.022z"],[1,"form-floating"],["id","floatingSelect","aria-label","providers select",1,"form-select",3,"ngModel","ngModelChange"],["disabled","",3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],["for","floatingSelect"],[3,"ngValue"],[1,"btn-outline-primary","btn","rounded-pill",3,"click"]],template:function(t,r){1&t&&(e.TgZ(0,"div",0)(1,"h3",1),e._uU(2,"Registrar orden"),e.qZA(),e._UZ(3,"hr"),e.TgZ(4,"div",2)(5,"div",3)(6,"h5",4),e._uU(7,"Lista de Materiales:"),e.qZA(),e.TgZ(8,"ul",5),e.YNc(9,Je,3,4,"li",6),e.qZA()(),e.TgZ(10,"div",3)(11,"h4"),e._uU(12,"Seleccione un Proveedor"),e.qZA(),e.YNc(13,Be,7,3,"div",7),e.YNc(14,Le,2,0,"button",8),e.TgZ(15,"app-warn-modal",9),e.NdJ("continue",function(i){return r.submit(i)}),e.qZA(),e.YNc(16,je,4,0,"div",10),e.qZA()()()),2&t&&(e.xp6(9),e.Q6J("ngForOf",r.reqMaterials),e.xp6(4),e.Q6J("ngIf",r.providers.length),e.xp6(1),e.Q6J("ngIf",r.reqMaterials),e.xp6(1),e.Q6J("btnMessage","Continuar"),e.xp6(1),e.Q6J("ngIf",!r.materials))},dependencies:[f.sg,f.O5,ee.u,u.YN,u.Kr,u.EJ,u.JJ,u.On]}),s})()}];let ze=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[O.Bz.forChild(Xe),O.Bz]}),s})();var $e=l(4466);let Ge=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[f.ez,ze,$e.m]}),s})()}}]);